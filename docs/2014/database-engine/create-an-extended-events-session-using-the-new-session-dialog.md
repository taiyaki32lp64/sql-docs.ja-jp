---
title: 新しいセッション ダイアログを使用して拡張イベント セッションの作成 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
f1_keywords:
- SQL12.SSMS.XEDISPLAY.GROUPING.F1
- SQL12.SSMS.XEDISPLAY.AGGREGATION.F1
- SQL12.SSMS.XEDISPLAY.NEWMERGEDCOLUMN.F1
- SQL12.SSMS.XENEWEVENTSESSION.GENERAL.F1
- SQL12.SSMS.XEDISPLAY.EDITCOLUMNS.F1
- SQL12.SSMS.XEDISPLAY.FILTERS.F1
helpviewer_keywords:
- Extended Events Dialog Box
ms.assetid: 6b2244bc-df6a-4b0a-990e-ddd8d42f7907
author: mashamsft
ms.author: mathoma
manager: craigg
ms.openlocfilehash: 39dd8c4f333df1528f3894ffc6dfe01a48a91f2c
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/15/2019
ms.locfileid: "66065023"
---
# <a name="create-an-extended-events-session-using-the-new-session-dialog"></a>[新しいセッション] ダイアログを使用した拡張イベント セッションの作成
  [新しいセッション] ダイアログでは、データのキャプチャ、表示、および分析を行う拡張イベント セッションを定義できます。 [新しいセッション] ダイアログでは、拡張イベントのすべての機能を使用できます。  
  
 拡張イベント セッションは、拡張イベントの大半の機能をサポートする [新規セッション ウィザード](../ssms/object/object-explorer.md) でも定義できます。  
  
## <a name="before-you-begin"></a>作業を開始する準備  
 [新しいセッション] ダイアログを開くには、オブジェクト エクスプローラーで **[管理]** ノードを展開し、 **[拡張イベント]** を展開します。 **[セッション]** を右クリックし、 **[新しいセッション]** をクリックします。  
  
##  <a name="BeforeYouBegin"></a> Permissions  
 拡張イベント セッションを作成するには、ALTER ANY EVENT SESSION 権限が必要です。  
  
## <a name="to-create-an-extended-events-session-using-the-new-session-dialog"></a>[新しいセッション] ダイアログを使用して拡張イベント セッションを作成するには  
 テンプレートを選択してイベント セッションのスケジュールを設定するには、 **[全般]** ページを使用します。  
  
#### <a name="to-select-a-template-and-schedule-an-event-session"></a>テンプレートを選択してイベント セッションのスケジュールを設定するには  
  
1.  オブジェクト エクスプローラーで **[管理]** ノードを展開し、 **[拡張イベント]** を展開します。 **[セッション]** を右クリックし、 **[新しいセッション]** をクリックします。  
  
2.  **[全般]** ページの **[セッション名]** ボックスに、イベント セッションのわかりやすい名前を入力します。  
  
3.  **[テンプレート]** ボックスで、使用するテンプレートをドロップダウン リストから選択します。  
  
     共通の問題を想定してあらかじめ構成された一連のテンプレートから選ぶことができるほか、 **[ファイルから]** を選択して、過去のセッション定義からエクスポートされたテンプレート ファイルを使用することもできます。 テンプレートの適用後に、セッションの構成を変更することもできます。  
  
4.  **[スケジュール]** セクションで、サーバーの起動時にセッションを開始する場合は、 **[サーバーの起動時にイベント セッションを開始する]** チェック ボックスをオンにします。  
  
     セッションの作成後にセッションを開始する場合は、 **[セッションの作成後すぐにイベント セッションを開始する]** チェック ボックスをオンにします。  
  
5.  イベント セッションのライブ データを表示するには、 **[ライブ データのキャプチャ時に画面でライブ データを監視する]** をクリックします。 セッションの作成直後からライブ データにトレース結果が表示されます。  
  
6.  複数のタスクにわたって作業を追跡するには、 **[因果関係の追跡]** セクションで、 **[イベントを相互に関連付ける方法を追跡する]** チェック ボックスをオンにします。  
  
     因果関係の追跡の詳細については、「セッションの内容と特性」を参照してください、 [SQL Server 拡張イベント セッション](../relational-databases/extended-events/sql-server-extended-events-sessions.md)トピック。  
  
     セッションにイベントを追加するには、 **[ページの選択]** セクションの **[イベント]** をクリックします。  
  
    > [!NOTE]  
    >  イベント セッションの作成が完了するまで、 **[OK]** はクリックしないでください。  
  
 セッションに関してキャプチャするイベントを探して追加するには、 **[イベント]** ページを使用します。  
  
#### <a name="to-add-events-to-a-session"></a>セッションにイベントを追加するには  
  
1.  [新しいセッション] ダイアログの **[ページの選択]** セクションで、 **[イベント]** をクリックします。  
  
2.  **[イベント]** ページの **[選択]** をクリックします ( **[キャプチャするイベントの選択]** 画面が既に表示されている場合、 **[選択]** ボタンは淡色表示されます)。  
  
     検索する文字列を **[イベント ライブラリ]** ボックスに入力することによって、テーブル内から任意の単語を検索できます。 たとえば、 **lock_acquired** イベントを検索するには、「 **lock** 」または「 **lock acquire**」のように入力できます。  
  
3.  **[イベント ライブラリ]** セクションで、キャプチャするイベントの検索方法をドロップダウン リストから選択します。 たとえば、イベント名を検索する以外にも、イベント名とその説明を検索することができます。 **[検索]** ボックスに検索条件を入力します。  
  
    > [!NOTE]  
    >  **[デバッグ]** チャネルのイベントは、既定では表示されません。 デバッグ イベントを表示するには、 **[チャネル]** ボックスの一覧の **[デバッグ]** を選択します。  
  
     **[イベント ライブラリ]** の詳細ペインには、選択したイベントの詳細が表示されます。  
  
     イベントは、名前のアルファベット順で並べ替えが行われます。 他のイベント情報で並べ替えるには、該当する列見出しをクリックします。 たとえば、 **[カテゴリ]** 列や **[チャネル]** 列で並べ替えることができます。  
  
4.  キャプチャするイベントを選択し、右矢印をクリックして、 **[選択したイベント]** セクションに移動します。  
  
    > [!NOTE]  
    >  **[イベント ライブラリ]** からは、Ctrl キーまたは Shift キーを使用して複数のイベントを同時に選択できます。  
  
     選択したイベントを構成するには、 **[構成]** をクリックします。  
  
    > [!NOTE]  
    >  イベント セッションの作成が完了するまで、 **[OK]** はクリックしないでください。  
  
 イベント セッションにターゲットを追加するには、 **[データ ストレージ]** ページを使用します。 ターゲットは、イベント データを格納するほか、アクションを実行することもできます。たとえば、イベントを後で閲覧できるようにファイルに保存することも、セッションのイベント データを集計することもできます。 拡張イベント ターゲットの詳細については、「 [SQL Server 拡張イベント ターゲット](../../2014/database-engine/sql-server-extended-events-targets.md)」を参照してください。  
  
 拡張イベント セッションで使用できるターゲットは次のとおりです。  
  
-   **etw_classic_sync_target**。 SQL Server イベントを、Windows オペレーティング システムまたはアプリケーション イベント データと関連付けます。  
  
-   **event_counter**。 拡張イベント セッションの開始後に発生した、すべての指定されたイベントをカウントします。 完全なイベント コレクションのオーバーヘッドを追加しなくても、負荷の特性に関する情報を取得できます。  
  
-   **event_file**。 イベント セッション出力を、メモリ バッファー全体からディスクに書き込みます。  
  
-   **histogram**。 指定されたイベント列またはアクションに基づいて、指定されたイベントが発生する回数をカウントします。  
  
-   **pair_matching**。 指定された 1 対のイベントの組み合わせが一致するかどうかを判定します。  
  
-   **ring_buffer**。 先入れ先出し (FIFO) 順またはイベントごとの FIFO に基づいて、イベント データをメモリに格納します。  
  
#### <a name="to-configure-global-fields-for-a-session"></a>セッションのグローバル フィールドを構成するには  
  
1.  **[イベント]** ページで、イベント セッションに追加するイベントを選択した後、 **[構成]** をクリックします。  
  
     **[構成]** をクリックすると、 **[イベント ライブラリ]** セクションが折りたたまれて、 **[選択したイベント]** セクションがページの左側にスライドします。 イベントの構成に使用する **[イベントの構成オプション]** セクションがページの右側に表示されます。 イベント セッションに対応するアクションは、このページの各タブを使用して構成します。  
  
2.  **[グローバル フィールド]** タブで、選択したイベントに適用するフィールドを選択します。  
  
     イベントごとに複数のフィールドを選択できます。  
  
    > [!NOTE]  
    >  既に選択されている 2 つのイベントに対して異なるアクションが構成されている場合、オンとオフの中間状態でアクションが表示されます。 チェック ボックスの上にある列見出しをクリックして有効/無効状態で並べ替えると、有効にしたアクションをすばやく探すことができます。  
  
3.  **[フィルター]** タブでは、フィルターを適用することによって、キャプチャするイベントを制限することができます。フィルターは "述語" と呼ばれることもあります。  
  
     選択したイベントにフィルターを適用した場合、列にチェックが表示されます。  
  
    > [!NOTE]  
    >  フィルターの適用対象となるイベントは、Ctrl キーまたは Shift キーを使用することで複数選択することができます。 ただし、構成対象として表示されるのは、共通するイベント フィールドだけです。 選択した 2 つのイベントに対し、既に異なるフィルターが構成されている場合、フィルターは表示されません。 フィルターを再構成すると既存のフィルターの値が上書きされます。  
  
    > [!NOTE]  
    >  フィルターのグループ句を構成した場合、結果が保存された後で、冗長なかっこがフィルターから削除されます。 たとえば、 **Clause 1** と **Clause 2**をグループ化するフィルターを作成した場合、これらの句を囲むかっこが表示されます。 フィルターを保存すると、冗長なかっこが削除されます。 かっこを削除しても、フィルターのロジックには影響しません。  
  
4.  **[イベント フィールド]** タブでは、選択したイベントに適用するイベント フィールドを選択します。  
  
     イベントには、必ず収集されるフィールドが多数存在します。こうしたフィールドは、 **[イベント フィールド]** タブにチェック ボックスなしで表示されます。 イベントには、既定では収集されないオプションのフィールドも存在します (たとえば、高コストなオプション フィールドは選択されません)。 **[イベント フィールド]** タブには、オプションのフィールドが、チェック ボックス付きで表示されます。 オプションのフィールドを収集するには、オプションのフィールドの前にあるチェック ボックスをオンにします。  
  
    > [!NOTE]  
    >  イベント フィールドのオプションには、キャプチャされてトレース結果に表示されるフィールドが表示されます (拡張イベントによって表示されるのはイベント フィールドのデータ型だけです。 たとえば、読み取り専用のイベント フィールドは表示されません)。複数のイベントを選択した場合、[新しいセッション] ダイアログの **[イベント フィールド]** タブの表示が空になります。  
  
5.  イベント セッションにターゲットを追加するには、 **[ページの選択]** セクションの **[データ ストレージ]** を選択します。  
  
    > [!NOTE]  
    >  イベント セッションの作成が完了するまで、 **[OK]** はクリックしないでください。  
  
#### <a name="to-add-targets-to-an-event-session"></a>ターゲットをイベント セッションに追加するには  
  
1.  [新しいセッション] ダイアログの **[ページの選択]** セクションで、 **[データ ストレージ]** を選択します。  
  
2.  **[データ ストレージ]** ページで、ドロップダウン リストからターゲットの種類を選択します。  
  
     ターゲットの種類を選択すると、ターゲットの説明が表示されます。 ターゲットを追加できるのは 1 回だけです。 既にセッションに追加されているターゲットは、ドロップダウン リストに表示されません。  
  
3.  イベント セッションのターゲットを追加するには、 **[追加]** をクリックします。 ターゲットを削除するには、 **[削除]** をクリックします。  
  
     選択したターゲットに応じたターゲット プロパティが **[ターゲット]** セクションに表示されます。  
  
4.  以下の表は、選択したターゲットと指定できるプロパティとの対応関係を示したものです。  
  
    |移行先|ターゲットのプロパティ|  
    |------------|-----------------------|  
    |**etw_classic_sync_target**|**[サーバーのセッション ログ ファイルの名前]** 。 サーバー上のログ ファイルの名前とディレクトリを入力します。 **[参照]** をクリックして、目的のログ ファイルを探して選択することもできます。<br /><br /> **[ログ ファイルの最大サイズ]** 。 Windows イベント トレーシング (ETW) イベントに対するログ ファイルの最大サイズを入力します。 既定値は 20 MB です。 異なるストレージ ユニットをドロップダウン リストから選択することができます。<br /><br /> **[バッファー サイズ]** 。 イベント セッションのインメモリのバッファー サイズを入力します。 既定値は 128 KB です。 異なるストレージ ユニットをドロップダウン リストから選択することができます。<br /><br /> **[セッション名]** 。 ETW セッションのわかりやすい名前を入力します。<br /><br /> **[ETW への書き込み中にエラーが発生した場合は再試行する]** 。 ETW サブシステムへのイベントのパブリッシュを再試行するには、このチェック ボックスをオンにします。<br /><br /> **[最大再試行回数]** 。 ETW サブシステムへのイベントのパブリッシュを最大何回まで再試行するかを入力します。この回数を超えるとイベントが破棄されます。 既定の再試行回数は 0 です。 このターゲット プロパティでは、0 (ゼロ) は再試行しないことを意味します。|  
    |**event_counter**|イベント カウンターには、ターゲット プロパティはありません。|  
    |**event_file**|**[サーバー上のファイル名]** 。 サーバー上のディレクトリとターゲット ファイルの名前を入力します。 **[参照]** をクリックして、目的のターゲット ファイルを探して選択することもできます。<br /><br /> **[最大ファイル サイズ]** 。 ターゲット ファイルの最大サイズを指定します。 ファイルの最大サイズを指定しない場合、ファイルはディスクがいっぱいになるまで拡張されます。 既定のファイル サイズは 1 GB です。 異なるストレージ ユニットをドロップダウン リストから選択することができます。<br /><br /> **[ファイル ロールオーバーを有効にする]** 。 ファイル ターゲットに対してファイル ロールオーバーを有効にするには、このチェック ボックスをオンにします。<br /><br /> **[ファイルの最大数]** 。 ファイル システム内に保持するファイルの最大数を入力します。|  
    |**histogram**|**[フィルター処理するイベント]** 。 ドロップダウン リストからフィルター処理するイベントを選択します。 イベント セッションに存在するすべてのイベントをフィルター処理できます。 選択することも **\<None >** すべてのイベントおよびアクションの基準のバケットを含むドロップダウン リストから。<br /><br /> **バケットの基準。アクション**します。 データ ソースとして使用されるアクション名をバケットの基準とするには、このオプションを選択し、ドロップダウン リストから目的のアクションを選択します。<br /><br /> **バケットの基準。フィールド**します。 データ ソースとして使用されるイベント フィールドをバケットの基準とするには、このオプションを選択し、ドロップダウン リストから目的のフィールドを選択します。<br /><br /> **[バケットの最大数]** 。 保持するバケットの最大数を入力します。 この値に達した場合、既存のバケットに属していない新しいイベントは無視されます。|  
    |**pair_matching**|**イベント:始まる**します。 対で発生するイベントのうち最初に発生するイベントを指定します。ドロップダウン リストからイベント名を選択します。<br /><br /> **イベント:終わる**します。 対で発生するイベントのうち最後に発生するイベントを指定します。ドロップダウン リストからイベント名を選択します。<br /><br /> **フィールドとアクション:始まる**します。 対で発生するフィールド/アクションのうち最初に発生するフィールド/アクションをドロップダウン リストから選択します。<br /><br /> **フィールドとアクション:終わる**します。 対で発生するフィールド/アクションのうち最後に発生するフィールド/アクションをドロップダウン リストから選択します。<br /><br /> **[メモリ不足が発生した場合はペアになっていない新しいイベントを破棄する]** 。 コンピューターのメモリ不足が発生したときに、pair_matching ターゲットへのイベントの収集を停止するには、このチェック ボックスをオンにします。 メモリ不足の状況が解消した時点で、イベントの収集が再開されます。<br /><br /> **[孤立イベントの最大数]** 。 メモリに保持する孤立イベントの最大数を指定します。|  
    |**ring_buffer**|**[保持するイベントの数]** 。 上矢印と下矢印を使用して、保持するイベントの数を指定します。 既定値は 1000 です。<br /><br /> **[バッファー メモリの最大サイズ]** 。 使用するメモリの最大量を入力します。 この値に達すると、既存のイベントが破棄されます。 既定のメモリ サイズは、無制限を意味する 0 MB です。 異なるストレージ ユニットをドロップダウン リストから選択することができます。<br /><br /> **[バッファーがいっぱいになったときには指定された数のイベント (種類ごと) を保持する]** 。 種類ごとの指定した数のイベントをバッファーに保持するには、このオプションを選択します。<br /><br /> **[保持するイベントの数 (種類ごと)]** 。 バッファーに保持するイベントの種類ごとの数を入力します。|  
  
5.  詳細な構成プロパティを設定するには、 **[ページの選択]** セクションで **[詳細設定]** を選択します。  
  
    > [!NOTE]  
    >  イベント セッションの作成が完了するまで、 **[OK]** はクリックしないでください。  
  
#### <a name="to-set-advanced-configurations"></a>詳細な構成を設定するには  
  
1.  [新しいセッション] ダイアログの **[ページの選択]** セクションで、 **[詳細設定]** をクリックします。  
  
2.  **[詳細設定]** ページで、イベント セッションの **[イベント保存モード]** オプションを指定し、次の手順に従います。  
  
    1.  **[1 つのイベントの損失]** : 1 つのイベントの損失を許容するには、このオプションを選択します。  
  
    2.  **[複数のイベントの損失]** : 複数のイベントの損失を許容するには、このオプションを選択します。  
  
    3.  **[イベントの損失なし (非推奨)]** : イベントの損失を防ぐは、このオプションを選択します。 このオプションは推奨されません。  
  
        > [!NOTE]  
        >  **sqlos.wait_info** イベントなど一部のイベントは、 **[イベントの損失なし]** のイベント保存モードと互換性がありません。  
  
3.  イベント セッションに対して **[ディスパッチの最大待機時間]** オプションを指定するには、次の手順に従います。  
  
    1.  **[秒単位]** : 最大ディスパッチ待機時間を長くしたり短くしたりするには、このオプションを選択します。 上矢印および下矢印を使用して、最大ディスパッチ待機時間を秒単位で指定します。  
  
    2.  **[無制限]** : バッファーがいっぱいになったときにだけイベントをディスパッチする場合は、このオプションを選択します。  
  
4.  **[メモリの最大サイズ]** ボックスに、メモリの最大サイズを入力します。 この値に達すると、既存のイベントが破棄されます。 異なるストレージ ユニットをドロップダウン リストから選択することができます。  
  
5.  **[イベントの最大サイズ]** ボックスには、大きすぎて **[メモリの最大サイズ]** に収まらないイベントの最大サイズを入力します。 収集しようとするイベントがそれほど大きくない場合、このオプションを構成する必要はありません。 異なるストレージ ユニットをドロップダウン リストから選択することができます。  
  
6.  イベント セッションに対して **[メモリ パーティション モード]** オプションを指定するには、次の手順に従います。  
  
    1.  **None**。 メモリ パーティション モードが不要である場合は、このオプションを選択します。  
  
    2.  **[ノードごと]** : ノードごとにメモリを分割する必要がある場合は、このオプションを選択します。  
  
    3.  **[CPU ごと]** : CPU ごとにメモリを分割する必要がある場合は、このオプションを選択します。  
  
 以上に示したセッション プロパティの構成を既定値に戻すには、 **[既定値に戻す]** をクリックします。  
  
## <a name="see-also"></a>参照  
 [クエリ エディターを使用して拡張イベント セッションを作成します。](../../2014/database-engine/create-an-extended-events-session-using-query-editor.md)   
 [ウィザードを使用して拡張イベント セッションの作成&#40;オブジェクト エクスプ ローラー&#41;](../ssms/object/object-explorer.md)   
 [拡張イベント セッションのスクリプト化](../../2014/database-engine/script-an-extended-event-session.md)  
  
  
