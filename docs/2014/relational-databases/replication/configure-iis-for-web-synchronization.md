---
title: Web 同期用の IIS の構成 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- IIS server configuration [SQL Server replication]
- websync.log
- Web synchronization, IIS servers
ms.assetid: d651186e-c9ca-4864-a444-2cd6943b8e35
author: MashaMSFT
ms.author: mathoma
manager: craigg
ms.openlocfilehash: a5c3b456fa650cff94d0b5809c37f7ceca8b1b71
ms.sourcegitcommit: 961c56bb78ff46ae6eb1a2cc5d2b1262ddf7a4fa
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/03/2019
ms.locfileid: "74706669"
---
# <a name="configure-iis-for-web-synchronization"></a>Web 同期用の IIS の構成
  ここでは、マージ レプリケーション用に Web 同期を構成する 2 番目の手順を説明します。 この手順は、Web 同期用にパブリケーションを有効にした後に実行します。 構成プロセスの概要については、「 [[Web 同期の構成]](configure-web-synchronization.md)」を参照してください。 ここでの手順を完了したら、続いて、Web 同期が使用されるようにサブスクリプションを構成する 3 番目の手順を実行してください。 3 番目の手順については、次のトピックで説明します。  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]: [Web 同期\(を使用するようにサブスクリプションを構成する\)方法 SQL Server Management Studio](https://msdn.microsoft.com/library/ms345214.aspx)  
  
-   レプリケーション [!INCLUDE[tsql](../../includes/tsql-md.md)] プログラミング: [Web 同期を使用するようにサブスクリプションを構成する方法 (レプリケーション Transact-SQL プログラミング)](https://msdn.microsoft.com/library/ms345206.aspx)  
  
-   RMO: [Web 同期を使用するようにサブスクリプションを構成する方法 (RMO プログラミング)](https://msdn.microsoft.com/library/ms345207.aspx)  
  
 Web 同期では、 [!INCLUDE[msCoName](../../includes/msconame-md.md)] インターネット インフォメーション サービス (IIS) を実行するコンピューターを使用して、プル サブスクリプションをマージ パブリケーションに同期します。 IIS バージョン 5.0、IIS バージョン 6.0、および IIS バージョン 7.0 がサポートされます。 IIS 7.0 では、Web 同期の構成ウィザードはサポートされていません。  
  
> [!IMPORTANT]  
>  アプリケーションで [!INCLUDE[dnprdnlong](../../includes/dnprdnlong-md.md)] 以降のバージョンのみが使用されることと、 [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] の以前のバージョンが IIS サーバーにインストールされていないことを確認します。 
  [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] の以前のバージョンを使用するとエラーが発生する可能性があります。 たとえば、"Web 同期中のメッセージの形式が無効でした。 Web サーバーでレプリケーション コンポーネントが正しく構成されていることを確認してください。" というエラーなどです。  
  
> [!CAUTION]  
>  WebSync と代替スナップショット フォルダーの場所を同時に使用しないでください。  
  
 Web 同期を使用するには、次の手順を完了して IIS を構成する必要があります。 ここでは、各手順を詳しく説明します。  
  
1.  SSL (Secure Sockets Layer) を構成します。 IIS とすべてのサブスクライバー間の通信には SSL が必要です。  
  
2.  インストールウィザードを使用して、IIS を実行しているコンピューターに接続コンポーネントをインストール[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]します。 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 手順 3. で説明する Web 同期の構成ウィザードを使用する場合は、IIS を実行しているコンピューターに [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] もインストールする必要があります。  
  
3.  IIS を実行しているコンピューターを Web 同期用に構成します。 手動でコンピューターを構成するか、Web 同期の構成ウィザードを使用できます。 ウィザードを使用することをお勧めします。  
  
    > [!NOTE]  
    >  IIS を実行しているコンピューターで、64 ビット バージョンの Windows を実行している場合は、以下のコマンドを実行して、ISAPI (インターネット サーバー API) アプリケーションを実行できるようにサーバーを適切に構成する必要があります。 詳細については、IIS のマニュアルを参照してください。  
  
    ```  
    cscript %SystemDrive%\inetpub\AdminScripts\adsutil.vbs set w3svc/AppPools/Enable32bitAppOnWin64 1  
    ```  
  
4.  
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーに適切な権限を設定します。  
  
5.  診断モードで Web 同期を実行し、IIS を実行しているコンピューターへの接続をテストして、SSL 証明書が正しくインストールされることを確認します。  
  
## <a name="configuring-secure-sockets-layer"></a>Secure Sockets Layer の構成  
 SSL を構成するには、IIS を実行しているコンピューターが使用する証明書を指定する必要があります。 マージ レプリケーション用の Web 同期では、サーバー証明書のみがサポートされており、クライアント証明書はサポートされていません。 配置用に IIS を構成するには、最初に証明機関 (CA) から証明書を取得する必要があります。 証明機関とは、ユーザー、コンピューター、およびその他の証明機関に属する公開暗号化キーの正当性の証明および保証を行う機関のことです。 証明書の詳細については、IIS のマニュアルを参照してください。 証明書をインストールしたら、その証明書を Web 同期で使用する Web サイトと関連付ける必要があります。  
  
#### <a name="to-specify-a-certificate-for-deployment"></a>配置用に証明書を指定するには  
  
1.  IIS を実行しているコンピューターに管理者としてログオンします。  
  
2.  
  **[インターネット インフォメーション サービス (IIS) マネージャー]** を起動します。  
  
    1.  
  **[スタート]** ボタンをクリックして **[ファイル名を指定して実行]** をクリックします。  
  
    2.  [**名前**] ボックスに「 `inetmgr`」と入力し、[ **OK**] をクリックします。  
  
3.  IIS 証明書ウィザードを実行します。  
  
    1.  
  **インターネット インフォメーション サービス (IIS) マネージャー**で、 **[ローカル コンピューター]** ノードを展開し、 **[Web サイト]** フォルダーを展開します。  
  
    2.  
  **[既定の Web サイト]** を右クリックし、 **[プロパティ]** をクリックします。  
  
    3.  
  **[既定の Web サイトのプロパティ]** ダイアログ ボックスの **[ディレクトリ セキュリティ]** タブで、 **[サーバー証明書]** をクリックします。  
  
    4.  Web サーバー証明書ウィザードを実行します。  
  
4.  [**OK**] をクリックすると、  
  
 CA からサーバー証明書を取得できない場合は、テスト用に証明書を指定できます。 テスト用に IIS 6.0 を構成するには、SelfSSL ユーティリティを使用して証明書をインストールします。 このユーティリティは、IIS 6.0 リソース キットで使用できます。 ツールは、 [Microsoft ダウンロード センター](https://www.microsoft.com/download/details.aspx?id=5135)からダウンロードできます。 IIS 5.0 の場合は、 [Microsoft ヘルプとサポート](https://go.microsoft.com/fwlink/?LinkId=46229)を参照してください。  
  
> [!NOTE]  
>  Web サイトで SSL を使用できるようにするには、事前に証明書を Web サイトに関連付ける必要があります。 SelfSSL を使用すると、証明書が既定の Web サイトに自動的に関連付けられます。 既に証明書を保有しているか、または後で CA から証明書をインストールする場合は、証明書を Web 同期で使用する Web サイトと明示的に関連付ける必要があります。 サブスクリプションの同期に使用する Web サイトに関連付けられた証明書が 1 つしか存在しないことを確認します。 複数の証明書が存在する場合、サブスクライバーは使用可能な最初の Web サイトを使用します。  
  
#### <a name="to-specify-a-certificate-for-testing-in-iis-60"></a>IIS 6.0 でテスト用に証明書を指定するには  
  
1.  IIS を実行しているコンピューターに管理者としてログオンします。  
  
2.  SelfSSL をダウンロードしてインストールします。 このアプリケーションの既定のインストール先は \<*drive*>:\Program Files\IIS Resources\SelfSSL です。 アプリケーションおよびマニュアルのショートカットが \<*drive*>:\Documents and Settings\All Users\Start Menu\Programs\IIS Resources\SelfSSL にコピーされます。  
  
3.  SelfSSL を実行します。  
  
    -   すべてのパラメーターに既定値を指定して SelfSSL を実行するには、アプリケーションのインストール ディレクトリに移動して、SelfSSL.exe をダブルクリックします。  
  
        > [!NOTE]  
        >  SelfSSL を使用してインストールした証明書の既定の有効期限は 7 日間です。  
  
    -   1 つ以上のパラメーターの値を指定するには、 **[スタート]** ボタンをクリックし、 **[ファイル名を指定して実行]** をクリックします。 [**名前**] ボックスに「 `cmd`」と入力し、[ **OK**] をクリックします。 SelfSSL のインストール ディレクトリに移動して「 `SelfSSL`」と入力し、1 つ以上のパラメーターの値を指定します。 パラメーターの一覧を確認する場合は、「 `SelfSSL -?`」と入力します。  
  
## <a name="installing-connectivity-components-and-sql-server-management-studio"></a>接続コンポーネントと SQL Server Management Studio のインストール  
  
#### <a name="to-install-sql-server-connectivity-components-and-sql-server-management-studio"></a>SQL Server 接続コンポーネントと SQL Server Management Studio をインストールするには  
  
1.  IIS を実行しているコンピューターに管理者としてログオンします。  
  
2.  
  [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] インストール ディスクから [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インストール ウィザードを起動します。 このウィザードの使用の詳細については、「インストール[ウィザードから SQL Server 2014 をインストールする」 &#40;セットアップ&#41;](../../database-engine/install-windows/install-sql-server-from-the-installation-wizard-setup.md)を参照してください。  
  
3.  
  **[機能の選択]** ページで、 **[クライアント ツール接続]** を選択します。  
  
4.  Web 同期の構成ウィザードを使用する場合は、 **[管理ツール - 基本]** を選択します。  
  
5.  ウィザードを終了して、コンピューターを再起動します。  
  
    > [!NOTE]  
    >  他のコンポーネントをインストールすることもできますが、Web 同期で必要なのは接続コンポーネントだけです。  
  
## <a name="configuring-the-computer-that-is-running-iis-by-using-the-configure-web-synchronization-wizard"></a>Web 同期の構成ウィザードを使用した、IIS を実行しているコンピューターの構成  
 Web 同期の構成ウィザードを使用して、IIS サーバーを構成します。 このウィザードを使用することをお勧めしますが、次のセクションで手動での構成の手順も説明します。 
  [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] に付属する Web 同期ウィザードは、 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)]を実行中のパブリッシャーまたは [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)]にアップグレードされたパブリッシャーで作成されたパブリケーションのみに使用できます。 このウィザードは、 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]のパブリケーションには使用できません。 このウィザードは、 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 以降のバージョンおよび [!INCLUDE[ssEWnoversion](../../includes/ssewnoversion-md.md)] 3.0 以降のバージョンのサブスクリプションで使用できます。  
  
 この構成の特徴は次のとおりです。  
  
-   IIS で既定の Web サイトを使用します。 ただし、別の Web サイトを使用することもできます。 Web サイトを作成する方法の詳細については、IIS のマニュアルを参照してください。  
  
    > [!NOTE]  
    >  指定した Web サイトから Web 同期で使用するコンポーネントにアクセスできます。 Web サイトの構成を行わなければ、そのサイトで他のデータや Web ページにアクセスすることはできません。  
  
-   仮想ディレクトリおよびこのディレクトリに関連付けられた別名を作成します。 この別名は、Web 同期コンポーネントにアクセスするときに使用されます。 たとえば、IIS のアドレスが https://*server.domain.com* である場合に、別名を "websync1" と指定すると、replisapi.dll コンポーネントにアクセスするアドレスは https://*server.domain.com*/websync1/replisapi.dll となります。  
  
-   基本認証を使用します。 基本認証の使用をお勧めする理由は、基本認証では、Kerberos 委任を必要とすることなく、IIS と [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] パブリッシャーまたはディストリビューターを別々のコンピューターで実行すること (推奨の構成) が可能になるからです。 基本認証を使用した SSL では、ログインやパスワードなどすべてのデータが暗号化されて送信されます (使用する認証の種類にかかわらず、SSL は必須です)。Web 同期のベストプラクティスの詳細については、「web 同期の[構成](configure-web-synchronization.md)」の「web 同期のセキュリティのベストプラクティス」を参照してください。  
  
#### <a name="to-configure-the-computer-that-is-running-iis-by-using-the-configure-web-synchronization-wizard"></a>Web 同期の構成ウィザードを使用して IIS を実行しているコンピューターを構成するには  
  
1.  IIS を実行しているコンピューターで、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]を起動します。  
  
2.  パブリッシャーに接続し、サーバー ノードを展開します。  
  
3.  
  **[ローカル パブリケーション]** フォルダーを展開し、パブリケーションを右クリックして、 **[Web 同期の構成]** をクリックします。  
  
4.  Web 同期の構成ウィザードの **[サブスクライバーの種類]** ページで、 **[SQL Server]** をクリックします。  
  
5.  
  **[Web サーバー]** ページで以下の操作を行います。  
  
    1.  サブスクリプションを同期する IIS のインスタンスを選択します。  
  
    2.  
  **[新しい仮想ディレクトリを作成する]** をクリックします。  
  
    3.  ページの下のペインで IIS のインスタンスを展開してから、 **[Web サイト]** を展開して、 **[既定の Web サイト]** をクリックします。  
  
6.  
  **[仮想ディレクトリ情報]** ページで以下の操作を行います。  
  
    1.  
  **[別名]** ボックスに仮想ディレクトリの別名を入力します。  
  
    2.  
  **[パス]** ボックスに、仮想ディレクトリのパスを入力します。 たとえば、[**エイリアス**] ボックス`websync1`に「」と入力し`C:\Inetpub\wwwroot\websync1`た場合は、[**パス**] ボックスに「」と入力します。 
  **[次へ]** をクリックします。  
  
    3.  両方のダイアログ ボックスで **[はい]** をクリックします。 これにより、新しいフォルダーを作成し、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ISAPI (インターネット サーバー API) の DLL をコピーします。 .  
  
7.  
  **[認証済みアクセス]** ページで以下の操作を行います。  
  
    1.  
  **[統合 Windows 認証]** と **[Windows ドメイン サーバーでダイジェスト認証を使用する]** チェック ボックスがオフになっていることを確認します。  
  
    2.  
  **[基本認証]** を選択します。  
  
    3.  
  **[既定のドメイン]** ボックスおよび **[領域]** ボックスに、IIS を実行しているコンピューターのドメインを入力します。  
  
8.  
  **[ディレクトリ アクセス]** ページで以下の操作を行います。  
  
    1.  
  **[追加]** をクリックし、 **[ユーザーまたはグループの選択]** ダイアログ ボックスで、サブスクライバーが IIS への接続に使用するアカウントを追加します。 これらのアカウントは、サブスクリプションの新規作成ウィザードの **[Web サーバー情報]** ページで指定するか、 [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)*@internet_login* パラメーターの値として指定します。  
  
9. 
  **[スナップショットの共有へのアクセス]** ページで、スナップショット共有を入力します。 サブスクライバーがスナップショット ファイルにアクセスできるように、この共有に適切な権限を設定します。 共有の権限の詳細については、「[スナップショット フォルダーのセキュリティ保護](security/secure-the-snapshot-folder.md)」を参照してください。  
  
10. 
  **[ウィザードの完了]** ページの **[完了]** をクリックします。  
  
     IIS を実行しているリモート コンピューターの構成中に発生したネットワーク エラーなど、何らかの障害が発生した場合、完了済みの操作はすべてロールバックされ、残りの操作は中止されます。 完了済みの操作をロールバックできない場合、ウィザードの最後のページの状態は " **成功** " と表示され、完了済みのアクションはコミットされたままとなります。  
  
11. IIS を実行しているコンピューターで、64 ビット バージョンの Windows を実行している場合、replisapi.dll を適切なディレクトリにコピーする必要があります。  
  
    1.  
  **[スタート]** ボタンをクリックして **[ファイル名を指定して実行]** をクリックします。 [**名前**] ボックスに「 `iisreset`」と入力し、[ **OK**] をクリックします。  
  
    2.  IIS が停止して再起動したら、 [!INCLUDE[ssInstallPathVar](../../includes/ssinstallpathvar-md.md)]COM\replisapi から手順 6b. で指定したディレクトリに replisapi.dll をコピーします。  
  
    3.  
  **[スタート]** ボタンをクリックして **[ファイル名を指定して実行]** をクリックします。 [**名前**] ボックスに「 `cmd`」と入力し、[ **OK**] をクリックします。  
  
    4.  手順 6b. で指定したディレクトリで、次のコマンドを実行します。  
  
         `regsvr32 replisapi.dll`  
  
## <a name="manually-configuring-the-computer-that-is-running-iis"></a>IIS を実行しているコンピューターの手動の構成  
 IIS を実行しているコンピューターを手動で構成するには、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーをインストールおよび構成し、IIS に接続するサブスクライバーの認証を構成する必要があります。  
  
#### <a name="to-install-and-configure-the-sql-server-replication-listener"></a>SQL Server レプリケーション リスナーのインストールと構成を行うには  
  
1.  IIS を実行しているコンピューターに、replisapi.dll を格納するファイル ディレクトリを作成します。 ディレクトリはどこに作成してもかまいませんが、\<*drive*>:\Inetpub ディレクトリの下に作成することをお勧めします。 たとえば、ディレクトリ \<*drive*>:\Inetpub\SQLReplication\\ を作成します。  
  
    > [!IMPORTANT]  
    >  FAT ファイル システム パーティションではなく NTFS ファイル システム パーティションにこのディレクトリを作成することを強くお勧めします。 NTFS ファイル システムであれば、NTFS ファイル システムのファイル アクセス許可を使用して、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションにアクセスできるユーザーを厳密に制御することができます。  
  
2.  replisapi.dll を [!INCLUDE[ssInstallPathVar](../../includes/ssinstallpathvar-md.md)]com\ ディレクトリから、手順 1. で作成したファイル ディレクトリにコピーします。  
  
3.  次の手順に従って replisapi.dll を登録します。  
  
    1.  
  **[スタート]** ボタンをクリックして **[ファイル名を指定して実行]** をクリックします。 [**名前**] ボックスに「 `cmd`」と入力し、[ **OK**] をクリックします。  
  
    2.  手順 1. で作成したディレクトリで、次のコマンドを実行します。  
  
         `regsvr32 replisapi.dll`  
  
4.  レプリケーション用の新しい Web サイトを作成するか、既存のサイトを使用します。 Web サイトは、同期の際にレプリケーション コンポーネントからアクセスされます。 Web サイトを作成する方法の詳細については、IIS のマニュアルを参照してください。  
  
5.  IIS で仮想ディレクトリを作成します。 仮想ディレクトリは、手順 4. で作成した Web サイトの下に作成し、手順 1. で作成したディレクトリにマッピングします。 仮想ディレクトリを作成する方法の詳細については、IIS のマニュアルを参照してください。 このディレクトリに割り当てる権限は、最小限にすることをお勧めします。 
  **[読み取り]** 権限と **[ISAPI アプリケーションや CGI などを実行する]** 権限は選択する必要がありますが、 **[ASP などのスクリプトを実行する]**、 **[書き込み]**、および **[参照]** 権限は選択しなくてもかまいません。  
  
6.  replisapi.dll を実行できるように IIS を構成します。 手順 4. で割り当てた権限は、以前のバージョンの IIS では十分ですが、IIS バージョン 6.0 では ISAPI (インターネット サーバー API) 拡張を有効にする必要があります。 詳細については、IIS 6.0 のマニュアルの「ISAPI 拡張を構成する」および「動的コンテンツを有効および無効にする」を参照してください。  
  
#### <a name="to-configure-iis-authentication"></a>IIS 認証を構成するには  
  
-   サブスクライバーが IIS に接続するには、サブスクライバーがリソースやプロセスにアクセスする前に、IIS がサブスクライバーを認証する必要があります。 IIS では、匿名認証、基本認証、統合認証の 3 種類の認証方式が用意されています。 認証は、Web サイト全体または作成した特定の仮想ディレクトリに適用することができます。  
  
     基本認証と SSL を組み合わせて使用することをお勧めします。 使用する認証の種類にかかわらず、SSL は必須です。 認証を構成する方法の詳細については、IIS のマニュアルを参照してください。  
  
## <a name="setting-permissions-for-the-sql-server-replication-listener"></a>SQL Server レプリケーション リスナーの権限の設定  
 サブスクライバーが IIS を実行しているコンピューターに接続するときは、IIS の構成時に指定した認証の種類を使用して、サブスクライバーが認証されます。 IIS はサブスクライバーを認証した後、サブスクライバーに [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションを実行する権限があるかどうかを確認します。 replisapi.dll の権限を設定して、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションを実行できるユーザーを制御します。 
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションに許可なくアクセスされることがないように権限を正しく構成する必要があります。  
  
 
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーの実行に使用するアカウントを最小の権限で構成するには、次の手順を完了する必要があります。 手順は、IIS 6.0 の実行[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)]に適用されます。  
  
 次の手順の他に、PAL (パブリケーション アクセス リスト) に必要なログインが登録されていることを確認してください。 PAL の詳細については、「[Secure the Publisher (パブリッシャーのセキュリティ保護)](security/secure-the-publisher.md)」を参照してください。  
  
#### <a name="to-configure-the-account-and-permissions"></a>アカウントと権限を構成するには  
  
1.  IIS を実行しているコンピューターでローカル アカウントを作成します。  
  
    1.  
  **[マイ コンピューター]** を右クリックし、 **[管理]** をクリックします。  
  
    2.  
  **[コンピューターの管理]** で、 **[ローカル ユーザーとグループ]** を展開します。  
  
    3.  
  **[ユーザー]** を右クリックし、 **[新しいユーザー]** をクリックします。  
  
    4.  ユーザー名と複雑なパスワードを入力します。  
  
    5.  
  **[作成]**、**[閉じる]** の順にクリックします。  
  
2.  アカウントを IIS_WPG グループに追加します。  
  
    1.  
  **[コンピューターの管理]** で、 **[ローカル ユーザーとグループ]** を展開し、 **[グループ]** をクリックします。  
  
    2.  
  **[IIS_WPG]** を右クリックし、 **[グループに追加]** をクリックします。  
  
    3.  
  **[IIS_WPG のプロパティ]** ダイアログ ボックスで、 **[追加]** をクリックします。  
  
    4.  
  **[ユーザー、コンピューター、またはグループの選択]** ダイアログ ボックスで、手順 1. で作成したアカウントを追加します。  
  
    5.  
  **[場所を指定してください]** フィールドの名前が、ドメインではなくローカル コンピューターの名前であることを確認します。 ローカル コンピューターの名前でない場合は、 **[場所]** をクリックします。 
  **[場所]** ダイアログ ボックスで、ローカル コンピューターを選択し、 **[OK]** をクリックします。  
  
    6.  
  **[ユーザーの選択]** ダイアログ ボックスと **[IIS_WPG のプロパティ]** ダイアログ ボックスで、 **[OK]** をクリックします。  
  
3.  replisapi.dll が保存されているフォルダーに対する最小限の権限をアカウントに許可します。  
  
    1.  replisapi.dll のために作成したフォルダーに移動し、フォルダーを右クリックして、 **[共有とセキュリティ]** をクリックします。  
  
    2.  
  **[セキュリティ]** タブで **[追加]** をクリックします。  
  
    3.  
  **[ユーザー、コンピューター、またはグループの選択]** ダイアログ ボックスで、手順 1. で作成したアカウントを追加します。  
  
    4.  
  **[場所を指定してください]** フィールドの名前が、ドメインではなくローカル コンピューターの名前であることを確認します。 ローカル コンピューターの名前でない場合は、 **[場所]** をクリックします。 
  **[場所]** ダイアログ ボックスで、ローカル コンピューターを選択し、 **[OK]** をクリックします。  
  
    5.  アカウントには、**[読み取り]**、**[読み取りと実行]**、**[フォルダーの内容の一覧表示]** のみが許可されていることを確認します。  
  
    6.  ディレクトリにアクセスする必要がないユーザーまたはグループを選択し、 **[削除]** をクリックします。  
  
    7.  [**OK**] をクリックすると、  
  
4.  
  **インターネット インフォメーション サービス (IIS) マネージャー**でアプリケーション プールを作成します。  
  
    1.  
  **[スタート]** ボタンをクリックして **[ファイル名を指定して実行]** をクリックします。  
  
    2.  [**名前**] ボックスに「 `inetmgr`」と入力し、[ **OK**] をクリックします。  
  
    3.  
  **インターネット インフォメーション サービス (IIS) マネージャー**で、 **[ローカル コンピューター]** ノードを展開します。  
  
    4.  
  **[アプリケーション プール]** を右クリックし、 **[新規作成]** をポイントしてから **[アプリケーション プール]** をクリックします。  
  
    5.  
  **[アプリケーション プール ID]** フィールドにプールの名前を入力し、 **[OK]** をクリックします。  
  
5.  アカウントとアプリケーション プールを関連付けます。  
  
    1.  
  **インターネット インフォメーション サービス (IIS) マネージャー**で、 **[ローカル コンピューター]** ノードを展開し、 **[アプリケーション プール]** を展開します。  
  
    2.  作成したアプリケーション プールを右クリックして、 **[プロパティ]** をクリックします。  
  
    3.  [ ** \<「Applicationpoolname」> のプロパティ**] ダイアログボックスの [ **id** ] タブで、[**構成可能**] をクリックします。  
  
    4.  
  **[ユーザー名]** および **[パスワード]** フィールドに、手順 1. で作成したアカウントとパスワードを入力します。  
  
    5.  [**OK**] をクリックすると、  
  
6.  Web 同期に使用する仮想ディレクトリにアプリケーション プールを関連付けます。  
  
    1.  
  **インターネット インフォメーション サービス (IIS) マネージャー**で、 **[ローカル コンピューター]** ノードを展開し、 **[Web サイト]** を展開します。  
  
    2.  Web 同期に使用している Web サイトを展開し、Web 同期用に作成した仮想ディレクトリを右クリックして、 **[プロパティ]** をクリックします。  
  
    3.  
  **[** VirtualDirectoryName> のプロパティ]** ダイアログ ボックスの \<[仮想ディレクトリ]** タブで、手順 5. で作成したアプリケーション プールを **[アプリケーション プール]** ボックスから選択します。  
  
    4.  [**OK**] をクリックすると、  
  
## <a name="testing-the-connection-to-replisapidll"></a>replisapi.dll への接続のテスト  
 診断モードで Web 同期を実行すると、IIS を実行しているコンピューターへの接続をテストして、SSL (Secure Sockets Layer) 証明書が正しくインストールされているかどうかを確認できます。 診断モードで Web 同期を実行するには、IIS を実行しているコンピューターの管理者である必要があります。  
  
#### <a name="to-test-the-connection-to-replisapidll"></a>replisapi.dll への接続をテストするには  
  
1.  サブスクライバーの LAN (ローカル エリア ネットワーク) が正しく設定されていることを確認します。  
  
    1.  Internet [!INCLUDE[msCoName](../../includes/msconame-md.md)] Explorer で、[**ツール**] メニューの [**インターネットオプション**] をクリックします。  
  
    2.  
  **[接続]** タブで、 **[LAN の設定]** をクリックします。  
  
    3.  LAN でプロキシ サーバーを使用していない場合は、 **[設定を自動的に検出する]** と **[LAN にプロキシ サーバーを使用する]** チェック ボックスをオフにします。  
  
    4.  プロキシ サーバーを使用している場合は、 **[LAN にプロキシ サーバーを使用する]** と **[ローカル アドレスにはプロキシ サーバーを使用しない]** チェック ボックスをオンにします。  
  
    5.  [**OK**] をクリックすると、  
  
2.  サブスクライバー側の Internet Explorer から診断モードでサーバーに接続します。診断モードで接続するには、replisapi.dll のアドレスの後に「 `?diag` 」を追加します。 (例: https://server.domain.com/directory/replisapi.dll?diag)。  
  
3.  IIS に指定した証明書が Windows オペレーティング システムによって認識されない場合は、 **[セキュリティの警告]** ダイアログ ボックスが表示されます。 証明書がテスト用の証明書であるか、Windows が認識しない証明機関 (CA) によって発行されていると、この警告が表示されます。  
  
    > [!NOTE]  
    >  このダイアログ ボックスが表示されない場合は、アクセスしているサーバーの証明書が信頼された証明書としてサブスクライバーの証明書ストアに追加されていることが確認されます。 証明書のエクスポートの詳細については、IIS のマニュアルを参照してください。  
  
    1.  
  **[セキュリティの警告]** ダイアログ ボックスで、 **[証明書の表示]** をクリックします。  
  
    2.  
  **[証明書]** ダイアログ ボックスの **[全般]** タブで、 **[証明書のインストール]** をクリックします。  
  
    3.  証明書インポート ウィザードを実行します。このウィザードでは既定の値をそのまま使用します。  
  
    4.  
  **[セキュリティの警告]** ダイアログ ボックスで、 **[はい]** をクリックします。  
  
    5.  証明書のインポート ウィザードの確認ダイアログ ボックスで、 **[OK]** をクリックします。  
  
    6.  
  **[証明書]** ダイアログ ボックスを閉じます。  
  
    7.  
  **[セキュリティの警告]** ダイアログ ボックスで、 **[はい]** をクリックします。  
  
    > [!NOTE]  
    >  ユーザーの証明書がインストールされます。 IIS と同期するユーザーすべてに対してこの手順を実行する必要があります。  
  
4.  
  **[\<ServerName> に接続]** ダイアログ ボックスで、マージ エージェントが IIS サーバーへの接続に使用するログインとパスワードを指定します。 これらの資格情報は、サブスクリプションの新規作成ウィザードで指定することもできます。  
  
5.  
  **[SQL Web 同期診断情報]** と呼ばれる Internet Explorer のウィンドウで、ページの **[Status]** 列の値が **[SUCCESS]** になっていることを確認します。  
  
6.  証明書がサブスクライバーに正しくインストールされていることを確認します。  
  
    1.  Internet Explorer をいったん閉じてから、再度開きます。  
  
    2.  サーバーに診断モードで接続します。 証明書が正しくインストールされている場合は、 **[セキュリティの警告]** ダイアログ ボックスが表示されません。 ダイアログ ボックスが表示される場合は、マージ エージェントから IIS を実行しているコンピューターへの接続に失敗します。 アクセスしているサーバーの証明書が、信頼された証明書としてサブスクライバーの証明書ストアに追加されていることを確認する必要があります。 証明書のエクスポートの詳細については、IIS のマニュアルを参照してください。  
  
## <a name="see-also"></a>参照  
 [Web 同期の構成](configure-web-synchronization.md)  
  
  
