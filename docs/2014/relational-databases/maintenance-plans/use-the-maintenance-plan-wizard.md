---
title: メンテナンス プラン ウィザードの使用 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
f1_keywords:
- sql12.ag.maintwiz.planprop.f1
- sql12.ag.maintwiz.task.f1
- sql12.ag.maintwiz.maintcleanup.f1
- sql12.ag.maintwiz.indexdefrag.f1
- sql12.ag.maintwiz.order.f1
- sql12.ag.maintwiz.histcleanup.f1
- sql12.ag.maintwiz.backuplog.f1
- sql12.ag.maintwiz.progress.f1
- sql12.ag.maintwiz.execagentjob.f1
- sql12.ag.maintwiz.integrity.f1
- sql12.ag.maintwiz.welcome.f1
- sql12.ag.maintwiz.backupdiff.f1
- sql12.ag.maintwiz.server.f1
- sql12.ag.maintwiz.summary.f1
- sql12.ag.maintwiz.backupfull.f1
- sql12.ag.maintwiz.report.f1
- sql12.ag.maintwiz.shrinkdb.f1
- sql12.ag.maintwiz.reindex.f1
- sql12.ag.maintwiz.updatestats.f1
helpviewer_keywords:
- Maintenance Plan Wizard
- Database Maintenance Plan Wizard
- Database Maintenance Plan Wizard, starting
ms.assetid: db65c726-9892-480c-873b-3af29afcee44
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.openlocfilehash: 105e8022775642d915cbcedf180ed9e07f8bc958
ms.sourcegitcommit: 5e45cc444cfa0345901ca00ab2262c71ba3fd7c6
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/29/2019
ms.locfileid: "70153823"
---
# <a name="use-the-maintenance-plan-wizard"></a>メンテナンス プラン ウィザードの使用
  このトピックでは、 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]でメンテナンス プラン ウィザードを使用して、単一サーバーまたはマルチサーバーのメンテナンス プランを作成する方法について説明します。 メンテナンス プラン ウィザードを使用すると、 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントによって定期的に実行されるメンテナンス プランを作成できます。 これにより、バックアップ、データベースの整合性のチェック、データベース統計の更新など、さまざまなデータベース管理タスクを指定した間隔で実行できます。  
  
 **このトピックの内容**  
  
-   **作業を開始する準備:**  
  
     [制限事項と制約事項](#Restrictions)  
  
     [Security](#Security)  
  
-   [SQL Server Management Studio のメンテナンスプランウィザードを使用したメンテナンスプランの作成](#SSMSProcedure)  
  
##  <a name="BeforeYouBegin"></a> はじめに  
  
###  <a name="Restrictions"></a> 制限事項と制約事項  
  
-   マルチサーバー メンテナンス プランを作成するには、1 台のマスター サーバーと 1 台以上のターゲット サーバーを含むマルチサーバー環境を構成する必要があります。 マルチサーバー メンテナンス プランは、マスター サーバー上で作成および管理する必要があります。 このプランはターゲット サーバー上でも表示できますが、ターゲット サーバーでは管理できません。  
  
-   **db_ssisadmin** ロールおよび **dc_admin** ロールのメンバーは、特権を **sysadmin**に昇格できる可能性があります。 このような特権の昇格が発生するのは、それらのロールが [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] パッケージを変更でき、これらのパッケージを [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントの **sysadmin** セキュリティ コンテキストを使用して [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] で実行できるためです。 メンテナンス プラン、データ コレクション セット、およびその他の [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] パッケージの実行時にこの特権の昇格を防ぐには、特権が制限されたプロキシ アカウントを使用するようにパッケージを実行する [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント ジョブを構成するか、 **db_ssisadmin** ロールおよび **dc_admin** ロールには **sysadmin** メンバーのみを追加するようにします。  
  
###  <a name="Security"></a> セキュリティ  
  
####  <a name="Permissions"></a> Permissions  
 メンテナンス プランを作成または管理するには、 **sysadmin** 固定サーバー ロールのメンバーである必要があります。 ユーザーが **sysadmin** 固定サーバー ロールのメンバーである場合のみ、オブジェクト エクスプローラーに **[メンテナンス プラン]** ノードが表示されます。  
  
##  <a name="SSMSProcedure"></a>メンテナンスプランウィザードの使用  
  
#### <a name="to-start-the-maintenance-plan-wizard"></a>メンテナンス プラン ウィザードを起動するには  
  
1.  管理計画を作成するサーバーを展開します。  
  
2.  **[管理]** フォルダーを展開します。  
  
3.  **[メンテナンス プラン]** フォルダーを右クリックし、 **[メンテナンス プラン ウィザード]** をクリックします。  
  
4.  **[SQL Server メンテナンス プラン ウィザード]** ページで **[次へ]** をクリックします。  
  
5.  **[プランのプロパティを選択]** ページで、次の操作を行います。  
  
    1.  **[名前]** ボックスに、作成するメンテナンス プランの名前を入力します。  
  
    2.  **[説明]** ボックスに、メンテナンス プランの簡単な説明を入力します。  
  
    3.  **[実行するアカウント名]** ボックスで、Microsoft SQL Server エージェントがメンテナンス プランを実行するときに使用する資格情報を指定します。  
  
    4.  **[タスクごとに個別のスケジュールを使用する]** または **[プラン全体で単一のスケジュールを使用するか、スケジュールを使用しない]** を選択して、メンテナンス プランの定期的なスケジュールを指定します。  
  
        > [!NOTE]  
        >  **[タスクごとに個別のスケジュールを使用する]** を選択した場合、メンテナンス プランのそれぞれのタスクに対して、**e** の手順を実行する必要があります。 の手順を実行する必要があります。  
  
    5.  **[プラン全体で単一のスケジュールを使用するか、スケジュールを使用しない]** を選択した場合、 **[スケジュール]** の **[変更]** をクリックします。  
  
        1.  **[新しいジョブ スケジュール]** ダイアログ ボックスで、 **[名前]** ボックスに、ジョブのスケジュールの名前を入力します。  
  
        2.  **[スケジュールの種類]** ボックスで、スケジュールの種類を選択します。  
  
            -   **[SQL Server エージェントの開始時に自動的に開始]**  
  
            -   **[CPU がアイドル状態になったときに開始]**  
  
            -   **[定期的]** 。 これは既定値です。  
  
            -   **指定日時**  
  
        3.  **[有効]** チェック ボックスをオンまたはオフにして、スケジュールを有効または無効にします。  
  
        4.  **[定期的]** を選択した場合:  
  
            1.  **[頻度]** の **[実行]** ボックスの一覧で、実行の頻度を指定します。  
  
                -   **[日単位]** を選択した場合は、 **[間隔]** ボックスに、ジョブ スケジュールを繰り返す頻度を日単位で入力します。  
  
                -   **[週単位]** を選択した場合は、 **[間隔]** ボックスに、ジョブ スケジュールを繰り返す頻度を週単位で入力します。 ジョブ スケジュールを実行する曜日を選択します。  
  
                -   **[月単位]** を選択した場合は、 **[日]** または **[曜日]** を選択します。  
  
                    -   **[日]** を選択した場合は、ジョブ スケジュールを実行する日付と、ジョブ スケジュールを繰り返す頻度を月単位で指定します。 たとえば、隔月の 15 日にジョブ スケジュールを実行する場合は、 **[日]** を選択し、1 番目のボックスに「15」と入力し、2 番目のボックスに「2」と入力します。 2 番目のボックスで使用できる最大の値は "99" であることに注意してください。  
  
                    -   **[曜日]** を選択した場合は、ジョブ スケジュールを実行する曜日と、ジョブ スケジュールを繰り返す頻度を月単位で指定します。 たとえば、隔月の最後の平日にジョブ スケジュールを実行する場合は、 **[日]** を選択し、リストから **[最終]** を選択します。次に 2 番目のリストから **[平日]** を選択し、最後のボックスに「2」と入力します。 **[第 1]** 、 **[第 2]** 、 **[第 3]** 、または **[第 4]** も、特定の平日 (たとえば、日曜日や水曜日) に加えて、最初の 2 つのリストから選択できます。 最後のボックスで使用できる最大の値は "99" であることに注意してください。  
  
            2.  **[一日のうちの頻度]** で、頻度、ジョブ スケジュールを実行する当日にジョブ スケジュールを繰り返す頻度を指定します。  
  
                -   **[1 回]** を選択した場合は、ジョブ スケジュールを実行する特定の時刻を **[1 回]** ボックスに入力します。 間、分、秒に加え、午前か午後かを入力します。  
  
                -   **[間隔]** を選択した場合は、 **[頻度]** で選択した日にジョブ スケジュールを実行する頻度を指定します。 たとえば、ジョブ スケジュールを実行する当日に 2 時間おきにジョブ スケジュールを実行する場合は、 **[間隔]** を選択し、1 番目のボックスに「2」と入力してから、 **[時間]** を選択します。 このリストでは、 **[分]** と **[秒]** を選択することもできます。 1 番目のボックスで使用できる最大の値は "100" であることに注意してください。  
  
                     **[開始]** ボックスに、ジョブ スケジュールの実行を開始する時刻を入力します。 **[終了]** ボックスに、ジョブ スケジュールの実行を終了する時刻を入力します。 間、分、秒に加え、午前か午後かを入力します。  
  
            3.  **[期間]** で、 **[開始日]** に、ジョブ スケジュールの実行を開始する日付を入力します。 **[終了日]** を選択します。ジョブ スケジュールの実行を停止するタイミングを指定しない場合は、 **[終了日なし]** を選択します。 **[終了日]** を選択した場合は、ジョブ スケジュールの実行を停止する日付を入力します。  
  
        5.  **[指定日時]** を選択した場合は、 **[指定日時に発生]** の **[日付]** ボックスに、ジョブ スケジュールを実行する日付を入力します。 **[時刻]** ボックスに、ジョブ スケジュールを実行する時刻を入力します。 間、分、秒に加え、午前か午後かを入力します。  
  
        6.  **[概要]** の **[説明]** で、すべてのジョブ スケジュール設定が適切であることを確認します。  
  
        7.  **[OK]** をクリックします。  
  
    6.  **[次へ]** をクリックします。  
  
6.  **[対象サーバーの選択]** ページで、メンテナンス プランを実行するサーバーを選択します。 このページは、マスター サーバーとして構成された [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インスタンスのみで表示されます。  
  
    > [!NOTE]  
    >  マルチサーバー メンテナンス プランを作成するには、1 台のマスター サーバーと 1 台以上のターゲット サーバーを含むマルチサーバー環境を構成する必要があります。ローカル サーバーをマスター サーバーとして構成することをお勧めします。 マルチサーバー環境では、このページに **"(local)"** マスター サーバーと、対応するすべてのターゲット サーバーが表示されます。  
  
7.  **[メンテナンス タスクの選択]** ページで、プランに追加するメンテナンス タスクを 1 つ以上選択します。 必要なタスクをすべて選択したら、 **[次へ]** をクリックします。  
  
    > [!NOTE]  
    >  ここで選択したタスクにより、次の **[メンテナンス タスクの順序を選択]** ページの後に指定するページが決まります。  
  
8.  **[メンテナンス タスクの順序を選択]** ページで、タスクを選択し、 **[上へ移動...]** または **[下へ移動...]** をクリックして、タスクの実行順序を変更します。 完了したら (またはタスクの現在の順序を受け入れる場合は)、 **[次へ]** をクリックします。  
  
    > [!NOTE]  
    >  上の **[プランのプロパティを選択]** ページで **[タスクごとに個別のスケジュールを使用する]** を選択した場合は、このページでメンテナンス タスクの順序を変更することはできません。  
  
#### <a name="define-database-check-integrity-checkdb-tasks"></a>データベースの整合性確認 (CHECKDB) タスクを定義する  
  
1.  **[データベースの整合性確認タスクの定義]** ページで、ユーザー テーブルとシステム テーブルの割り当ておよび構造的整合性、およびインデックスを確認するデータベースを選択します。 `DBCC CHECKDB`[!INCLUDE[tsql](../../includes/tsql-md.md)] ステートメントを実行することにより、データベースに整合性の問題があった場合は報告されるため、システム管理者またはデータベースの所有者によって対処できます。 詳細については、「[DBCC CHECKDB &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql)」を参照してください。完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[データベース]** ボックス  
     このタスクで操作するデータベースを指定します。  
  
    -   **[すべてのデータベース]**  
  
         **tempdb** を除くすべての [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] データベースを対象として、このタスクを実行するメンテナンス プランを生成します。  
  
    -   **システム データベース**  
  
         [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tempdb **およびユーザーが作成したデータベースを除く** システム データベースを対象として、このタスクを実行するメンテナンス プランを生成します。  
  
    -   **[すべてのユーザー データベース] (master、model、msdb、tempdb は対象外)**  
  
         ユーザーが作成したすべてのデータベースを対象として、このタスクを実行するメンテナンス プランを生成します。 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のシステム データベースではメンテナンス タスクは実行されません。  
  
    -   **[これらのデータベース]**  
  
         選択されたデータベースだけを対象として、このタスクを実行するメンテナンス プランを生成します。 このオプションをオンにする場合は、少なくとも 1 つのデータベースが一覧内で選択されている必要があります。  
  
     **[インデックスを含める]** チェック ボックス  
     すべてのインデックス ページおよびテーブル データ ページの整合性を確認します。  
  
#### <a name="define-database-shrink-tasks"></a>データベースの圧縮タスクを定義する  
  
1.  **[データベースの圧縮タスクの定義]** ページで、 `DBCC SHRINKDATABASE` ステートメントと `NOTRUNCATE` オプションまたは `TRUNCATEONLY` オプションを使用して、選択されているデータベースのサイズを小さくするタスクを作成します。 詳細については、「[DBCC SHRINKDATABASE &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-shrinkdatabase-transact-sql)」を参照してください。 完了したら、 **[次へ]** をクリックします。  
  
    > [!WARNING]  
    >  ファイルを圧縮するために移動されたデータは、ファイル内のあらゆる使用可能な場所に分散される場合があります。 これにより、インデックスの断片化が発生し、広範なインデックスを検索するクエリのパフォーマンスが低下する場合があります。 断片化を解消するには、圧縮後にファイルのインデックスを再構築することを検討してください。  
  
     このページで使用できるオプションを次に示します。  
  
     **[データベース]** ボックス  
     このタスクで操作するデータベースを指定します。 この一覧で利用可能なオプションの詳細については、上の手順 9. を参照してください。  
  
     **[次のサイズに到達したらデータベースを圧縮]** ボックス  
     このタスクが実行されるときのサイズをメガバイト単位で指定します。  
  
     **[圧縮後に残す空き領域]** ボックス  
     データベース ファイルの空き領域がこのサイズ (%) になったときに圧縮を停止します。  
  
     **[データベース ファイルの解放された領域を保持する]**  
     データベースは連続するページに圧縮されますが、ページの割り当ては解除されず、データベース ファイルは圧縮されません。 データベースを再度展開することが予想され、領域を再割り当てしない場合に、このオプションを使用します。 このオプションを指定した場合、データベース ファイルを可能な限り圧縮する動作は行われません。 NOTRUNCATE オプションが使用されます。  
  
     **[解放された領域をオペレーティング システムに返す]**  
     データベースは連続するページに圧縮され、そのページが他のプログラムで使用できるようにオペレーティング システムに返されます。 データベース ファイルは可能な限り圧縮されます。 TRUNCATEONLY オプションが使用されます。 既定のオプションです。  
  
#### <a name="define-the-index-tasks"></a>インデックスのタスクを定義する  
  
1.  **[インデックスの再構成タスクの定義]** ページで、インデックス ページをより効率的な検索順に移動する 1 つまたは複数のサーバーを選択します。 このタスクでは `ALTER INDEX ... REORGANIZE` ステートメントを使用します。 詳細については、「[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)」を参照してください。 完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[データベース]** ボックス  
     このタスクで操作するデータベースを指定します。 この一覧で利用可能なオプションの詳細については、上の手順 9. を参照してください。  
  
     **[オブジェクト]** ボックス  
     **[選択]** ボックスの一覧で、テーブル、ビュー、または両方を表示するように制限します。 この一覧は、上の **[データベース]** ボックスの一覧で 1 つのデータベースが選択されている場合にのみ表示されます。  
  
     **[選択]** ボックス  
     このタスクの対象とするテーブルまたはインデックスを指定します。 [オブジェクト] ボックスで **[テーブルとビュー]** が選択されている場合は、このオプションは利用できません。  
  
     **[ラージ オブジェクトを圧縮する]** チェック ボックス  
     可能であれば、テーブルとビューに対する領域の割り当てを解除します。 このオプションでは `ALTER INDEX ... LOB_COMPACTION = ON`を使用します。  
  
2.  **[インデックスの再構築タスクの定義]** ページで、複数のインデックスを再構築する 1 つまたは複数のデータベースを選択します。 このタスクでは `ALTER INDEX ... REBUILD PARTITION` ステートメントを使用します。 詳細については、「[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)」を参照してください。完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[データベース]** ボックス  
     このタスクで操作するデータベースを指定します。 この一覧で利用可能なオプションの詳細については、上の手順 9. を参照してください。  
  
     **[オブジェクト]** ボックス  
     **[選択]** ボックスの一覧で、テーブル、ビュー、または両方を表示するように制限します。 この一覧は、上の **[データベース]** ボックスの一覧で 1 つのデータベースが選択されている場合にのみ表示されます。  
  
     **[選択]** ボックス  
     このタスクの対象とするテーブルまたはインデックスを指定します。 [オブジェクト] ボックスで **[テーブルとビュー]** が選択されている場合は、このオプションは利用できません。  
  
     **[空き領域のオプション]** 領域  
     インデックスとテーブルに FILL FACTOR を適用するためのオプションが用意されています。  
  
     **[ページごとの既定の空き領域]**  
     既定の空き領域を使用してページを再構成します。 データベース内のテーブルに定義されているインデックスを削除し、インデックスの作成時に指定された FILL FACTOR を使用して、新しいインデックスを再作成します。 既定のオプションです。  
  
     **[ページごとの空き領域を変更する]** ボックス  
     データベース内のテーブルに定義されているインデックスを削除し、指定した割合の空き領域が各インデックス ページに確保されるように自動的に計算される FILL FACTOR の値を使用してインデックスを再作成します。 指定するパーセント値を大きくすると、インデックス ページに確保される空き領域が増えて、より多くのデータをインデックスに追加できるようになります。 有効値は、0 ～ 100 です。 `FILLFACTOR` オプションを使用します。  
  
     **[詳細設定オプション]** 領域  
     インデックスの並べ替えと再作成を行うためのオプションが用意されています。  
  
     **[tempdb の結果を並べ替える]** チェック ボックス  
     `SORT_IN_TEMPDB` オプションを使用して、インデックスの作成中に生成される並べ替えの中間結果を一時的に格納する場所を指定します。 並べ替え操作が必要ない場合、または並べ替えをメモリ上で実行できる場合、 `SORT_IN_TEMPDB` オプションは無視されます。  
  
     **[インデックスの再作成中にオンラインのインデックスを保持する]** チェック ボックス  
     `ONLINE` オプションを使用します。これにより、インデックス操作の実行中に、ユーザーは基になるテーブルまたはクラスター化インデックス データ、および任意の関連付けられた非クラスター化インデックスにアクセスできます。 このオプションを選択すると、インデックスを再構築するための追加のオプションとして、オンラインの再構築が許可されない **[インデックスを再構築しない]** と **[オフラインでインデックスを再構築する]** が有効になります。  
  
    > [!NOTE]  
    >  オンラインでのインデックス操作は、 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]のすべてのエディションで使用できるわけではありません。 詳しくは「 [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)」をご覧ください。  
  
#### <a name="define-the-update-statistics-task"></a>統計の更新タスクを定義する  
  
1.  **[統計の更新タスクの定義]** ページで、テーブルおよびインデックスの統計を更新する 1 つまたは複数のデータベースを定義します。 このタスクでは `UPDATE STATISTICS` ステートメントを使用します。 詳細については、「[UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql)」を参照してください。完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[データベース]** ボックス  
     このタスクで操作するデータベースを指定します。 この一覧で利用可能なオプションの詳細については、上の手順 9. を参照してください。  
  
     **[オブジェクト]** ボックス  
     **[選択]** ボックスの一覧で、テーブル、ビュー、または両方を表示するように制限します。 この一覧は、上の **[データベース]** ボックスの一覧で 1 つのデータベースが選択されている場合にのみ表示されます。  
  
     **[選択]** ボックス  
     このタスクの対象とするテーブルまたはインデックスを指定します。 [オブジェクト] ボックスで **[テーブルとビュー]** が選択されている場合は、このオプションは利用できません。  
  
     **[すべての既存の統計]**  
     列とインデックスの統計を両方とも更新します。  
  
     **[列統計のみ]**  
     列統計のみを更新します。 `WITH COLUMNS` オプションを使用します。  
  
     **[インデックス統計のみ]**  
     インデックス統計のみを更新します。 `WITH INDEX` オプションを使用します。  
  
     **[スキャンの種類]**  
     更新された統計情報を収集するスキャンの種類です。  
  
     **[フル スキャン]**  
     統計を収集する際、テーブルまたはビューのすべての行を読み取ります。  
  
     **[サンプル対象]**  
     大きなテーブルやビューの統計を収集するときにサンプリングする、テーブルまたはインデックス付きビューの割合や行数を指定します。  
  
#### <a name="define-the-history-cleanup-task"></a>履歴クリーンアップ タスクを定義する  
  
1.  **[履歴クリーンアップ タスクの定義]** ページで、古いタスク履歴を破棄する 1 つまたは複数のデータベースを定義します。 このタスクでは、 `EXEC sp_purge_jobhistory`、 `EXEC sp_maintplan_delete_log`、および `EXEC sp_delete_backuphistory` ステートメントを使用して、 **msdb** テーブルから履歴情報を削除します。 完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[削除する履歴データを選択]**  
     削除するタスク データの種類を選択します。  
  
     **[バックアップおよび復元の履歴]**  
     最新のバックアップを作成したときのレコードを保存しておくと、データベースの復元時に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] で復元プランを作成するのに役立ちます。 保存期間は、データベースの完全バックアップの実行間隔以上にする必要があります。  
  
     **[SQL Server エージェントのジョブ履歴]**  
     この履歴を利用して、失敗したジョブをトラブルシューティングしたり、データベース アクションの発生原因を調べたりできます。  
  
     **[メンテナンス プランの履歴]**  
     この履歴を利用して、失敗したメンテナンス プラン ジョブをトラブルシューティングしたり、データベース アクションの発生原因を調べたりできます。  
  
     **[これより古い履歴データの削除]**  
     削除するアイテムの古さを指定します。 **[時間]** , **[日]** , **[週]** (既定値)、 **[月]** 、または **[年]** を選択できます。  
  
#### <a name="define-the-execute-agent-job-task"></a>エージェント ジョブ実行タスクを定義する  
  
1.  **[エージェント ジョブ実行タスクの定義]** ページの **[使用できる SQL Server エージェント ジョブ]** で、実行する 1 つまたは複数のジョブを選択します。 SQL エージェント ジョブが存在しない場合は、このオプションを利用できません。 このタスクでは `EXEC sp_start_job` ステートメントを使用します。 詳細については、「[sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql)」を参照してください。完了したら、 **[次へ]** をクリックします。  
  
#### <a name="define-backup-tasks"></a>バックアップ タスクを定義する  
  
1.  **[データベースのバックアップ (完全) タスクの定義]** ページで、完全バックアップを実行する 1 つまたは複数のデータベースを選択します。 このタスクでは `BACKUP DATABASE` ステートメントを使用します。 詳細については、「 [BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql)」を参照してください。 完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[バックアップの種類]** ボックス  
     実行するバックアップの種類を表示します。 読み取り専用です。  
  
     **[データベース]** ボックス  
     このタスクで操作するデータベースを指定します。 この一覧で利用可能なオプションの詳細については、上の手順 9. を参照してください。  
  
     **[バックアップ コンポーネント]**  
     データベース全体をバックアップするには、 **[データベース]** を選択します。 データベースの一部だけをバックアップするには、 **[ファイルとファイル グループ]** を選択します。 後者のオプションを選択した場合は、ファイル名またはファイル グループ名を指定します。 **[データベース]** ボックスで複数のデータベースを選択した場合、 **[バックアップ コンポーネント]** には **[データベース]** のみを指定できます。 ファイルまたはファイル グループのバックアップを実行するには、データベースごとにタスクを作成します。 これらのオプションは、上の **[データベース]** ボックスの一覧で 1 つのデータベースが選択されている場合にのみ表示されます。  
  
     **[バックアップ セットの有効期限]** チェック ボックス  
     このバックアップのバックアップ セットがいつ上書きできるようになるかを指定します。 **[期間指定]** を選択して期限切れまでの日数を入力するか、または **[日時指定]** を選択して有効期限の日付を入力します。 **[URL]** がバックアップ先として選択された場合、このオプションは無効です。  
  
     **[バックアップ先]**  
     データベースをバックアップするメディアを指定します。 **[ディスク]** 、 **[テープ]** 、または **[URL]** を選択します。 データベースを格納しているコンピューターに接続したテープ デバイスのみを利用できます。  
  
     **[1 つ以上のファイルにデータベースをバックアップする]**  
     **[追加]** をクリックして **[バックアップ先の選択]** ダイアログ ボックスを開きます。 バックアップ先として [URL] を選択した場合、このオプションは無効になります。  
  
     ボックスからファイルを削除するには、 **[削除]** をクリックします。  
  
     ファイル ヘッダーを読み取り、ファイルの現在のバックアップ内容を表示するには、 **[コンテンツ]** をクリックします。  
  
     **[バックアップ先の選択]** ダイアログ ボックス  
     バックアップ先として、ファイル、テープ、またはバックアップ デバイスを選択します。 バックアップ先として [URL] を選択した場合、このオプションは無効になります。  
  
     **[バックアップ ファイルが存在する場合に行う操作]** ボックス  
     既存のバックアップを処理する方法を指定します。 ファイル内またはテープ上の既存のバックアップの後に新しいバックアップを追加するには、 **[追加]** を選択します。 ファイルまたはテープの古い内容を削除し、この新しいバックアップで置き換えるには、 **[上書き]** を選択します。  
  
     **[すべてのデータベースにバックアップ ファイルを作成する]**  
     [フォルダー] ボックスで指定された場所にバックアップ ファイルを作成します。 選択されたデータベースごとに、1 つのファイルが作成されます。 バックアップ先として [URL] を選択した場合、このオプションは無効になります。  
  
     **[データベースごとにサブディレクトリを作成する]** チェック ボックス  
     メンテナンス プランの一部としてバックアップされるデータベースごとに、データベース バックアップを格納するサブディレクトリを、指定されたディスク ディレクトリの下に作成します。  
  
    > [!IMPORTANT]  
    >  サブディレクトリには、親ディレクトリから権限が継承されます。 不正アクセスを防ぐには、権限を制限してください。  
  
     **[フォルダー]** ボックス  
     自動的に作成されたデータベース ファイルを格納するフォルダーを指定します。 バックアップ先として [URL] を選択した場合、このオプションは無効になります。  
  
     **[SQL 資格情報]**  
     Azure Storage の認証に使用する SQL 資格情報を選択します。 使用できる既存の SQL 資格情報がない場合は、 **[作成]** ボタンをクリックして新しい SQL 資格情報を作成します。  
  
    > [!IMPORTANT]  
    >  **[作成]** をクリックすると開くダイアログでは、サブスクリプションの管理証明書または公開プロファイルが求められます。 管理証明書または公開プロファイルにアクセスできない場合は、Transact-SQL または SQL Server Management Studio を使用してストレージ アカウント名とアクセス キーの情報を指定し、SQL 資格情報を作成することができます。 Transact-sql を使用して[資格情報を作成する](../security/authentication-access/create-a-credential.md#Credential)方法については、「」のサンプルコードを参照してください。 または SQL Server Management Studio を使用して、データベース エンジン インスタンスから、 **[セキュリティ]** を右クリックし、 **[新規作成]** 、 **[資格情報]** の順にクリックします。 **[ID]** にストレージ アカウント名、 **[パスワード]** にアクセス キーを指定します。  
  
     **[Azure ストレージ コンテナー]**  
     Azure ストレージコンテナーの名前を指定します  
  
     **[URL プレフィックス]**  
     これは、SQL 資格情報に格納されているストレージ アカウント情報と、指定した Azure ストレージ コンテナー名に基づいて自動的に生成されます。 **\<storage account>.blob.core.windows.net** 以外の形式を使ったドメインを使用している場合を除き、このフィールドの情報は編集しないことをお勧めします。  
  
     **[バックアップ ファイルの拡張子]** ボックス  
     バックアップ ファイルに使用する拡張子を指定します。 既定の拡張子は .bak です。  
  
     **[バックアップの整合性を検証する]** チェック ボックス  
     バックアップ セットが完全で、すべてのボリュームが読み取り可能であることを検証します。  
  
     **バックアップの暗号化**  
     暗号化されたバックアップを作成するには、 **[バックアップ ファイルを暗号化する]** チェック ボックスをオンにします。 暗号化手順に使用する暗号化アルゴリズムを選択し、既存の証明書または非対称キーの一覧から証明書または非対称キーを指定します。 暗号化に使用できるアルゴリズムは次のとおりです。  
  
    -   AES 128  
  
    -   AES 192  
  
    -   AES 256  
  
    -   Triple DES  
  
     既存のバックアップ セットに追加することを選択した場合、暗号化オプションは無効になります。  
  
     証明書またはキーをバックアップし、暗号化されたバックアップとは別の場所に保管することをお勧めします。  
  
     拡張キー管理 (EKM) に存在するキーのみがサポートされます。  
  
     **[バックアップの圧縮の設定]**  ボックスの一覧  
     [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)] (またはそれ以降のバージョン) で、 [バックアップの圧縮](../backup-restore/backup-compression-sql-server.md) の値を次の中から 1 つ選択します。  
  
    |||  
    |-|-|  
    |**[既定のサーバー設定を使用する]**|オンにすると、サーバー レベルの既定値が使用されます。 この既定値は、 **backup compression default** サーバー構成オプションで設定されます。 このオプションの現在の設定を表示する方法については、「 [backup compression default サーバー構成オプションの表示または構成](../../database-engine/configure-windows/view-or-configure-the-backup-compression-default-server-configuration-option.md)」を参照してください。|  
    |**[バックアップを圧縮する]**|オンにすると、サーバー レベルの既定値に関係なく、バックアップが圧縮されます。<br /><br /> **\*\* 重要 \*\*** 既定の設定では、圧縮によって CPU 使用率が著しく増加し、圧縮処理によって CPU がさらに消費されるために、同時に実行される操作が悪影響を受ける場合があります。 このため、リソース ガバナーによって CPU 使用率が制限されるセッションで、優先度の低い圧縮バックアップを作成することができます。 詳細については、「 [リソース ガバナーを使用してバックアップの圧縮による CPU 使用率を制限する方法 &#40;Transact-SQL&#41;](../backup-restore/use-resource-governor-to-limit-cpu-usage-by-backup-compression-transact-sql.md)」を参照してください。|  
    |**[バックアップを圧縮しない]**|オンにすると、サーバー レベルの既定値に関係なく、圧縮されていないバックアップが作成されます。|  
  
2.  **[データベースのバックアップ (差分) タスクの定義]** ページで、部分バックアップを実行する 1 つまたは複数のデータベースを選択します。 このページで利用可能なオプションの詳細については、上の手順 16. の定義リストを参照してください。 このタスクでは `BACKUP DATABASE ... WITH DIFFERENTIAL` ステートメントを使用します。 詳細については、「 [BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql)」を参照してください。  完了したら、 **[次へ]** をクリックします。  
  
3.  **[データベースのバックアップ (トランザクション ログ) タスクの定義]** ページで、(トランザクション ログのバックアップを実行する 1 つまたは複数のデータベースを選択します。 このページで利用可能なオプションの詳細については、上の手順 16. の定義リストを参照してください。 このタスクでは `BACKUP LOG` ステートメントを使用します。 詳細については、「 [BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql)」を参照してください。 完了したら、 **[次へ]** をクリックします。  
  
#### <a name="define-maintenance-cleanup-tasks"></a>メンテナンス クリーンアップ タスクを定義する  
  
1.  **[メンテナンス クリーンアップ タスクの定義]** ページで、メンテナンス プランで作成されたテキスト レポートやデータベースのバックアップ ファイルなど、メンテナンス プランの一部として削除するファイルの種類を指定します。 このタスクでは `EXEC xp_delete_file` ステートメントを使用します。 完了したら、 **[次へ]** をクリックします。  
  
    > [!IMPORTANT]  
    >  このタスクでは、指定したディレクトリのサブフォルダーにあるファイルは自動的に削除されません。 この予防策により、メンテナンス クリーンアップ タスクを使用してファイルを削除するような、悪意のある攻撃を受ける可能性を最小限に抑えています。 直下のサブフォルダーにあるファイルを削除する場合は、 **[直下のサブフォルダーを含める]** を選択する必要があります。  
  
     このページで使用できるオプションを次に示します。  
  
     **[次の種類のファイルを削除]**  
     削除するファイルの種類を指定します。  
  
     **[バックアップ ファイル]**  
     データベース バックアップ ファイルを削除します。  
  
     **[メンテナンス プラン テキスト レポート]**  
     以前に実行されたメンテナンス プランのテキスト レポートを削除します。  
  
     **ファイルの場所**  
     削除するファイルのパスを指定します。  
  
     **[特定のファイルを削除する]**  
     **[ファイル名]** ボックスに指定したファイルを削除します。  
  
     **[フォルダーを検索し、拡張子に基づいてファイルを削除する]**  
     指定したフォルダー内にある、指定した拡張子を持つすべてのファイルを削除します。 このオプションは、複数のファイルを削除するときに使用します。たとえば、拡張子が .bak であり Tuesday フォルダーに保存されている、すべてのバックアップ ファイルを一度に削除できます。  
  
     **[フォルダー]** ボックス  
     削除するファイルが格納されているフォルダーのパスと名前を指定します。  
  
     **[ファイル拡張子]** ボックス  
     削除するファイルのファイル拡張子を指定します。 複数のファイル、たとえば、Tuesday フォルダー内にある、.bak 拡張子が付いたすべてのバックアップ ファイルを一度に削除するには、次の手順に従います。  
  
     **[直下のサブフォルダーを含める]** チェック ボックス  
     **[フォルダー]** で指定したフォルダーの直下にあるサブフォルダーから、 **[ファイル拡張子]** で指定した拡張子を持つファイルを削除します。  
  
     **[タスク実行時にファイルの経過期間に基づいてファイルを削除する]** チェック ボックス  
     **[次の期間経過したファイルを削除]** ボックスに数値と時間単位を指定して、削除するファイルの最小経過期間を指定します。  
  
     **[次の期間経過したファイルを削除]**  
     数値と時間単位 ( **[時間]** 、 **[日]** 、 **[週]** 、 **[月]** 、または **[年]** ) を指定して、削除するファイルの最小経過期間を指定します。 指定した期間より古いファイルが削除されます。  
  
#### <a name="select-report-options"></a>レポート オプションを選択する  
  
1.  **[レポート オプションの選択]** ページで、メンテナンス プラン操作のレポートを保存または配布するためのオプションを選択します。 このタスクでは `EXEC sp_notify_operator` ステートメントを使用します。 詳細については、[sp_notify_operator &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-notify-operator-transact-sql)」を参照してください。完了したら、 **[次へ]** をクリックします。  
  
     このページで使用できるオプションを次に示します。  
  
     **[レポートをテキスト ファイルに書き込む]** チェック ボックス  
     レポートをファイルに保存します。  
  
     **[フォルダーの場所]** ボックス  
     レポートを格納するファイルの場所を指定します。  
  
     **[レポートを電子メールで送信する]** チェック ボックス  
     タスクが失敗した場合に電子メールを送信します。 このタスクを使用するには、[データベース メール] が有効になっていて、MSDB がメール ホスト データベースとして正しく構成され、有効な電子メール アドレスを持つ [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのオペレーターが存在している必要があります。  
  
     **[エージェント オペレーター]**  
     電子メールの受信者を指定します。  
  
     **[メール プロファイル]**  
     プロファイル定義する電子メールの送信者を指定します。  
  
#### <a name="complete-the-wizard"></a>ウィザードを完了する  
  
1.  **[ウィザードの完了]** ページで、これまでのページで選択した内容を確認し、 **[完了]** をクリックします。  
  
2.  **[メンテナンス プラン ウィザードの進行状況]** ページでは、メンテナンス プラン ウィザードの操作に関する状態情報を監視できます。 ウィザードで選択したオプションに応じて、[進行状況] ページに 1 つまたは複数のアクションが含まれる可能性があります。 上部のボックスには、ウィザードの全体的な状態と受信した状態メッセージ、エラー メッセージ、および警告メッセージの数が表示されます。  
  
     **[メンテナンス プラン ウィザードの進行状況]** ページでは、次のオプションを使用できます。  
  
     **詳細**  
     アクション、状態、およびウィザードで実行したアクションから返されたメッセージが提供されます。  
  
     **操作**  
     各アクションの種類と名前を指定します。  
  
     **ステータス**  
     全体としてウィザードのアクションが **[成功]** または **[失敗]** のいずれの値を返したかを示します。  
  
     **メッセージ**  
     プロセスから返されたすべてのエラー メッセージまたは警告メッセージを提供します。  
  
     **レポート**  
     パーティションの作成ウィザードの結果を含むレポートを作成します。 **[レポートの表示]** 、 **[レポートをファイルに保存]** 、 **[レポートをクリップボードにコピー]** 、 **[レポートを電子メールとして送信]** の各オプションがあります。  
  
     **[レポートの表示]**  
     パーティションの作成ウィザードの進行状況に関するテキスト レポートを表示する **[レポートの表示]** ダイアログ ボックスを開きます。  
  
     **[レポートをファイルに保存]**  
     **[レポートに名前を付けて保存]** ダイアログ ボックスを開きます。  
  
     **[レポートをクリップボードにコピー]**  
     ウィザードの進行状況レポートの結果をクリップボードにコピーします。  
  
     **[レポートを電子メールとして送信]**  
     ウィザードの進行状況レポートの結果を電子メール メッセージにコピーします。  
  
  
