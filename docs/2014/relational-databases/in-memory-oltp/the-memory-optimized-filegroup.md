---
title: メモリ最適化ファイルグループ | Microsoft Docs
ms.custom: ''
ms.date: 11/19/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 14106cc9-816b-493a-bcb9-fe66a1cd4630
author: CarlRabeler
ms.author: carlrab
manager: craigg
ms.openlocfilehash: 64402f73fdf43c0ebcbeff338ed72d56d55227be
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/15/2019
ms.locfileid: "63155576"
---
# <a name="the-memory-optimized-filegroup"></a>メモリ最適化ファイルグループ
  メモリ最適化テーブルを作成するには、まずメモリ最適化ファイルグループを作成する必要があります。 メモリ最適化ファイル グループには 1 つ以上のコンテナーが含まれています。 各コンテナーには、データ ファイルかデルタ ファイル、あるいはその両方が含まれています。  
  
 `SCHEMA_ONLY` テーブルからのデータ行は持続的ではなく、メモリ最適化テーブルに対応するメタデータおよびネイティブ コンパイル ストアド プロシージャは従来型のカタログに格納されますが、メモリ最適化テーブルを含むデータベースを一貫した環境で提供できるように、[!INCLUDE[hek_2](../../includes/hek-2-md.md)] エンジンでは引き続き、`SCHEMA_ONLY` メモリ最適化テーブルに対応するメモリ最適化ファイルグループが必要です。  
  
 メモリ最適化ファイルグループは FILESTREAM ファイルグループをベースとしていますが、次の違いがあります。  
  
-   メモリ最適化ファイルグループは、データベースごとに 1 つだけ作成できます。 memory_optimized_data を含めることにより、このファイルグループに明示的にマークを付ける必要があります。 データベースを作成するときにファイルグループを作成することも、後でファイルグループを追加することもできます。  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILEGROUP imoltp_mod CONTAINS MEMORY_OPTIMIZED_DATA  
    ```  
  
-   MEMORY_OPTIMIZED_DATA ファイルグループに対して、1 つ以上のコンテナーを追加する必要があります。 以下に例を示します。  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILE (name='imoltp_mod1', filename='c:\data\imoltp_mod1') TO FILEGROUP imoltp_mod  
    ```  
  
-   メモリ最適化ファイルグループを作成するために、ファイルストリームを有効にする必要はありません ([FILESTREAM の有効化と構成](../blob/enable-and-configure-filestream.md))。 ファイルストリームへのマッピングは、 [!INCLUDE[hek_2](../../includes/hek-2-md.md)] エンジンによって実行されます。  
  
-   メモリ最適化ファイルグループに対して、新しいコンテナーを追加することができます。 持続性のあるメモリ最適化テーブルに必要な記憶域を展開し、複数のコンテナーの I/O の分散の新しいコンテナーを使用する必要があります。  
  
-   メモリ最適化ファイルグループでのデータの移動は、AlwaysOn 可用性グループ構成によって最適化されます。 セカンダリ レプリカに送信されるファイルストリームのファイルとは異なり、メモリ最適化ファイルグループ内のチェックポイント ファイル (データとデルタの両方) は、セカンダリ レプリカには送信されません。 データ ファイルとデルタ ファイルは、セカンダリ レプリカのトランザクション ログを使用して作成されます。  
  
メモリ最適化ファイルグループには、次の制限が適用されます。  
  
-   メモリ最適化ファイルグループを作成した後、それを削除する唯一の方法はデータベースを削除することです。 運用環境において、メモリ最適化ファイルグループの削除が必要になることはほとんどありません。  
  
-   空ではないコンテナーを削除することや、メモリ最適化ファイルグループ内でデータ ファイルとデルタ ファイルのペアを別のコンテナーに移動することはできません。  
  
## <a name="configuring-a-memory-optimized-filegroup"></a>メモリ最適化ファイルグループの構成  
メモリ最適化ファイルグループ内で複数のコンテナーを作成し、それらを複数のドライブに分散して、データをメモリにストリーミングするための帯域幅をより多く確保することを考慮してください。  
  
記憶域を構成する場合には、持続性のあるメモリ最適化テーブルの 4 倍のサイズの空きディスク領域を指定する必要があります。 I/O サブシステムが、ワークロードの必要な IOPS をサポートしていることを確認します。 データ ファイルとデルタ ファイルのペアが特定の IOPS で作成される場合は、格納操作とマージ操作のために、3 倍の IOPS が必要です。 メモリ最適化ファイルグループに 1 つ以上のコンテナーを追加する方法で、記憶域容量と IOPS を追加できます。  
  
複数のコンテナーと複数のドライブを使用するシナリオでは、データ ファイルとデルタ ファイルはラウンドロビン方式でコンテナーに割り当てられます。 最初のデータ ファイルは最初のコンテナーから割り当てられ、デルタ ファイルは次のコンテナーから割り当てられ、というように、この割り当てパターンが繰り返されます。 奇数個のドライブがあり、それぞれを 1 個のコンテナーにマップした場合は、この割り当て方法により、データ ファイルとデルタ ファイルが複数のコンテナーに対して均等に分散されます。 一方、偶数個のドライブがあり、それぞれを 1 個のコンテナーにマップした場合は、データ ファイルが奇数番目のドライブにマップされ、デルタ ファイルが偶数番目のドライブにマップされて不均等な記憶域という結果になる可能性があります。 復旧での I/O バランスの取れたストリームを取得するには、次の例」の説明に従って、データとデルタ ファイルを同じスピンドル/記憶域のペアを配置することを検討します。  

> [!CAUTION]
> メモリ最適化ファイルグループに `MAXSIZE` 値が設定されており、チェックポイント ファイルがコンテナーの最大サイズを超えた場合、データベースは SUSPECT 状態になります。   
> この場合は、データベースの OFFLINE や ONLINE への設定を試行しないでください。試行すると、データベースが RECOVERY_PENDING 状態のままになります。
  
### <a name="example"></a>例 
2 個のコンテナーを持つメモリ最適化ファイルグループについて考えます。コンテナー 1 は X ドライブにあり、コンテナー 2 は Y ドライブにあります。  
データ ファイルとデルタ ファイルの割り当てはラウンドロビン方式でなされるため、コンテナー 1 にはデータ ファイルのみが格納され、コンテナー 2 にはデルタ ファイルのみが格納されます。このためデータ ファイルがデルタ ファイルよりはるかに大きくなり、記憶域と IOPS の両方に関して継続的に不均等が発生することになります。    
X と Y のドライブで一様にデータとデルタ ファイルを配布するには、代わりに、2 つの 4 つのコンテナーを作成し、最初の 2 つのコンテナーをドライブ X と Y ドライブに次の 2 つのコンテナーにマップします。  
ラウンド ロビン割り当てられる、最初のデータとデルタ ファイルの最初から割り当てられるコンテナー 1 とコンテナー 2 それぞれ、X ドライブにマップされます。   
同様に、次のデータとデルタ ファイルがコンテナー 3 と Y ドライブにマップするコンテナー 4 から割り当てられます。これにより、2 つのドライブで一様にデータとデルタ ファイルを配布できます。  
 
  
## <a name="see-also"></a>関連項目  
[メモリ最適化オブジェクト用ストレージの作成と管理](creating-and-managing-storage-for-memory-optimized-objects.md)     
[データベース ファイルとファイル グループ](../../relational-databases/databases/database-files-and-filegroups.md)    
  
