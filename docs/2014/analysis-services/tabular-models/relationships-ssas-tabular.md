---
title: リレーションシップ (SSAS テーブル) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 21e0144a-3cfd-4bc7-87ff-bb7d1800ed2f
author: minewiskan
ms.author: owend
manager: craigg
ms.openlocfilehash: 5a0a1527ed97570c715ff383837ebd5a9d5a3354
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/15/2019
ms.locfileid: "66066697"
---
# <a name="relationships-ssas-tabular"></a>リレーションシップ (SSAS テーブル)
  テーブル モデルでは、リレーションシップは 2 つのデータ テーブル間の接続を表します。 これにより、2 つのテーブルのデータの関連付けの方法が決まります。 たとえば、Customers テーブルと Orders テーブルを関連付けると、各注文に関連付けられた顧客名を表示できます。  
  
 テーブルのインポート ウィザードを使用して同じデータ ソースからインポートする場合に、データ ソースのテーブルに既に存在するリレーションシップをインポートするよう選択すると、そのリレーションシップはモデル内に再作成されます。 ダイアグラム ビューのモデル デザイナーまたは [リレーションシップの管理] ダイアログ ボックスを使用すると、自動的に検出および再作成されたリレーションシップを表示できます。 また、ダイアグラム ビューのモデル デザイナーを使用するか、[リレーションシップの作成] ダイアログ ボックスまたは [リレーションシップの管理] ダイアログ ボックスを使用すると、テーブル間に新しいリレーションシップを手動で作成することもできます。  
  
 インポート時に自動的に、または手動でテーブル間のリレーションシップを定義すると、関連付けられた列を使用してデータをフィルター処理したり、関連付けられたテーブル内の値を参照したりできるようになります。  
  
> [!TIP]  
>  モデルに多数のリレーションシップが含まれている場合に、テーブル間のリレーションシップを表示し、新しいリレーションシップを作成するには、ダイアグラム ビューを使用すると効果的です。  
  
 このトピックのセクション:  
  
-   [利点](#what)  
  
-   [リレーションシップの要件](#requirements)  
  
-   [リレーションシップの推定](#detection)  
  
-   [データのインポート時のリレーションシップの検出](#bkmk_detection)  
  
-   [リレーションシップの手動作成](#bkmk_manually_create)  
  
-   [値の重複などのエラー](#bkmk_dupl_errors)  
  
-   [関連タスク](#bkmk_related_tasks)  
  
##  <a name="what"></a> 利点  
 リレーションシップは、各テーブル内の 1 つ以上の列に基づく、2 つのデータ テーブル間の接続を表します。 リレーションシップが有用である理由を理解するために、業務において顧客注文のデータを追跡する場合を考えます。 すべてのデータは、次のような構造を持つ単一のテーブルで追跡できます。  
  
|CustomerID|名前|EMail|DiscountRate|OrderID|OrderDate|製品|Quantity|  
|----------------|----------|-----------|------------------|-------------|---------------|-------------|--------------|  
|1|Ashton|chris.ashton@contoso.com|.05|256|2010-01-07|Compact Digital|11|  
|1|Ashton|chris.ashton@contoso.com|.05|255|2010-01-03|SLR Camera|15|  
|2|Jaworski|michal.jaworski@contoso.com|.10|254|2010-01-03|Budget Movie-Maker|27|  
  
 この方法でも機能しますが、すべての注文に対して顧客の電子メール アドレスなど冗長なデータを多数格納することになってしまいます。 ストレージは安価ですが、電子メール アドレスが変更された場合には、その顧客に関連する行をすべて更新する必要があります。 この問題に対する解決策の 1 つとして、データを複数のテーブルに分割し、それらのテーブル間のリレーションシップを定義する方法があります。 これは、 *などの* リレーショナル データベース [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]で使用されている方法です。 たとえば、モデルにインポートしたデータベースでは、次の 3 つの関連テーブルを使用して注文データを表すことができます。  
  
### <a name="customers"></a>Customers  
  
|CustomerID|名前|EMail|  
|--------------------|----------|-----------|  
|1|Ashton|chris.ashton@contoso.com|  
|2|Jaworski|michal.jaworski@contoso.com|  
  
### <a name="customerdiscounts"></a>CustomerDiscounts  
  
|CustomerID|DiscountRate|  
|--------------------|------------------|  
|1|.05|  
|2|.10|  
  
### <a name="orders"></a>Orders  
  
|CustomerID|OrderID|OrderDate|製品|Quantity|  
|--------------------|-------------|---------------|-------------|--------------|  
|1|256|2010-01-07|Compact Digital|11|  
|1|255|2010-01-03|SLR Camera|15|  
|2|254|2010-01-03|Budget Movie-Maker|27|  
  
 これらのテーブルを同じデータベースからインポートした場合、テーブルのインポート ウィザードではテーブル間のリレーションシップを角かっこ ([ ]) で囲んで示した列に基づいて検出できるため、モデル デザイナーでこれらのリレーションシップを再現できます。 詳細については、このトピックの「 [リレーションシップの自動検出と自動推定](#detection) 」を参照してください。 複数のソースからテーブルをインポートした場合、「 [2 つのテーブル間のリレーションシップの作成 (SSAS テーブル)](create-a-relationship-between-two-tables-ssas-tabular.md)で使用されている方法です。  
  
### <a name="columns-and-keys"></a>列およびキー  
 リレーションシップは、同じデータが格納されている各テーブルの列に基づきます。 たとえば、Customers テーブルと Orders テーブルにはどちらにも顧客 ID を格納する列が含まれているため、これらのテーブルは相互に関連付けることができます。 この例では列名が同じになっていますが、これは必須条件ではありません。 Orders テーブルのすべての行に Customers テーブルにも格納されている ID が含まれていれば、一方の列名を CustomerID にして、もう一方の列名を CustomerNumber にすることもできます。  
  
 リレーショナル データベースの *キー*にはいくつかの種類があります。これらは通常、特殊なプロパティを含む単なる列です。 リレーショナル データベースでは次の 4 種類のキーを使用できます。  
  
-   *主キー*: Customers テーブルの CustomerID のように、テーブル内の行を一意に識別します。  
  
-   *代替キー* ( *候補キー*): 主キー以外の一意の列。 たとえば、従業員 ID と社会保障番号が Employees テーブルに格納されることがありますが、これらは両方とも一意です。  
  
-   *外部キー*: Customers テーブルの CustomerID を参照する Orders テーブルの CustomerID のように、別のテーブル内にある一意の列を参照する列。  
  
-   *複合キー*: 複数の列で構成されるキー。 複合キーは、テーブル モデルではサポートされていません。 詳細については、このトピックの「複合キーと参照列」を参照してください。  
  
 テーブル モデルでは、主キーや代替キーを *関連する参照列*と呼びます (単に *参照列*とも呼びます)。 テーブルに主キーと代替キーの両方がある場合は、どちらも参照列として使用できます。 外部キーは、 *ソース列* または *列*と呼ばれます。 上記の例では、Orders テーブルの CustomerID (列) と Customers テーブルの CustomerID (参照列) の間でリレーションシップが定義されます。 リレーショナル データベースからデータをインポートすると、モデル デザイナーでは、あるテーブルの外部キーと、別のテーブルの対応する主キーが既定により選択されます。 ただし、参照列には、一意の値を持つ任意の列を使用できます。  
  
### <a name="types-of-relationships"></a>リレーションシップの種類  
 Customers と Orders のリレーションシップは、 *一対多リレーションシップ*と呼ばれます。 各顧客は複数の注文を行うことができますが、1 つの注文に複数の顧客を含めることはできません。 リレーションシップのその他の種類として、 *一対一* と *多対多*があります。 顧客ごとに単一の割引率を定義する CustomerDiscounts テーブルは、Customers テーブルと一対一のリレーションシップを持ちます。 多対多リレーションシップの例としては、製品と顧客の間の直接的なリレーションシップがあります。このリレーションシップでは、1 人の顧客が複数の製品を購入することができ、同じ製品を複数の顧客が購入することができます。 モデル デザイナーのユーザー インターフェイスでは、多対多リレーションシップはサポートされていません。 詳細については、このトピックの「[多対多リレーションシップ](#bkmk_many_to_many)」を参照してください。  
  
 次の表は、3 つのテーブル間のリレーションシップを示しています。  
  
|リレーションシップ|型|参照列|[列]|  
|------------------|----------|-------------------|------------|  
|Customers-CustomerDiscounts|一対一|Customers.CustomerID|CustomerDiscounts.CustomerID|  
|Customers-Orders|一対多|Customers.CustomerID|Orders.CustomerID|  
  
### <a name="relationships-and-performance"></a>リレーションシップとパフォーマンス  
 通常、リレーションシップを作成した後は、新しく作成されたリレーションシップのテーブル内の列を使用する式をモデル デザイナーで再計算する必要があります。 データの量およびリレーションシップの複雑さによっては、この処理に時間がかかることがあります。  
  
##  <a name="requirements"></a> リレーションシップの要件  
 モデル デザイナーには、リレーションシップの作成時に従う必要がある要件がいくつかあります。  
  
### <a name="single-active-relationship-between-tables"></a>テーブル間に 1 つのアクティブなリレーションシップ  
 複数のリレーションシップを作成すると、テーブル間の依存関係があいまいになる可能性があります。 正確な計算を作成するには、テーブル間のパスを 1 つにする必要があります。 そのため、テーブルの各ペアの間に作成できるアクティブなリレーションシップは 1 つだけです。 たとえば、AdventureWorks DW 2012 には DimDate テーブルには、FactInternetSales テーブルの 3 つの異なる列に関連付けられた DateKey 列が含まれています。OrderDate、DueDate、および ShipDate します。 これらのテーブルをインポートしようとした場合、最初のリレーションシップは正常に作成されますが、同じ列を使用する後続のリレーションシップに関して次のエラーが出力されます。  
  
 \* リレーションシップ: table [column 1] が -> table [column 2] - 状態: エラー - 理由。テーブル間のリレーションシップを作成できません\<テーブル 1 > と\<2 のテーブル > です。 2 つのテーブル間に作成できる直接的または間接的なリレーションシップは 1 つだけです。  
  
 2 つのテーブルの間に複数のリレーションシップが存在している場合は、参照列を含むテーブルのコピーを複数インポートし、テーブルの各ペアの間にリレーションシップを 1 つ作成します。  
  
 テーブル間の非アクティブなリレーションシップは複数作成できます。 テーブル間で使用するパスは、レポート クライアントによってクエリ時に指定されます。  
  
### <a name="one-relationship-for-each-source-column"></a>ソース列ごとに 1 つのリレーションシップ  
 ソース列は、複数のリレーションシップに参加できません。 既に 1 つのリレーションシップである列をソース列として使用している場合、別のテーブルの別の関連参照列に関連付けるためにその列を使用するには、その列のコピーを作成して新しいリレーションシップに使用します。  
  
 計算列で DAX 数式を使用すると、値がまったく同じ列のコピーを簡単に作成できます。 詳細については、「[計算列の作成 (SSAS テーブル)](ssas-calculated-columns-create-a-calculated-column.md)」を参照してください。  
  
### <a name="unique-identifier-for-each-table"></a>テーブルごとに一意の識別子  
 各テーブルには、各行を一意に識別する列を 1 つ含める必要があります。 この列は、通常、主キーと呼ばれます。  
  
### <a name="unique-lookup-columns"></a>一意の参照列  
 参照列のデータ値は一意である必要があります。 つまり、参照列に重複値を格納することはできません。 テーブル モデルの場合、null と空の文字列は、明確なデータ値である空白と同じものとして扱われます。 つまり、参照列には複数の null を格納できません。  
  
### <a name="compatible-data-types"></a>互換性のあるデータ型  
 ソース列と参照列のデータ型には互換性がある必要があります。 データ型の詳細については、「[サポートされているデータ型 (SSAS テーブル)](data-types-supported-ssas-tabular.md)」を参照してください。  
  
### <a name="composite-keys-and-lookup-columns"></a>複合キーと参照列  
 テーブル モデルでは複合キーを使用できません。テーブルの各行を一意に識別する列は常に 1 つである必要があります。 複合キーに基づく既存のリレーションシップを持つテーブルをインポートしようとすると、このリレーションシップはテーブル モデルで作成できないため、テーブルのインポート ウィザードでは無視されます。  
  
 モデル デザイナーで 2 つのテーブル間のリレーションシップを作成する必要がある場合に、主キーと外部キーを定義する列が複数あるときは、リレーションシップを作成する前に、値を組み合わせて 1 つのキー列を作成しておく必要があります。 これはデータをインポートする前に行うことができます。また、モデル デザイナーで計算列を作成することによっても行うことができます。  
  
###  <a name="bkmk_many_to_many"></a> 多対多リレーションシップ  
 テーブル モデルは多対多リレーションシップをサポートしていないため、モデル デザイナー内に *交差テーブル* を追加することはできません。 ただし、DAX 関数を使用して、多対多リレーションシップをモデル化することができます。  
  
### <a name="self-joins-and-loops"></a>自己結合とループ  
 自己結合はテーブル モデルのテーブルでは許可されていません。 自己結合は、テーブルとそれ自体との間の再帰的なリレーションシップです。 自己結合は、親子階層を定義するためによく使用されます。 たとえば、Employees テーブルの自己結合を行うと、業務の管理チェーンを示す階層を生成できます。  
  
 モデル デザイナーでは、モデル内のリレーションシップの間にループを作成することはできません。 つまり、以下に示すリレーションシップのセットは禁止されています。  
  
 テーブル 1 の列 a   から   テーブル 2 の列 f  
  
 テーブル 2 の列 f   から   テーブル 3 の列 n  
  
 テーブル 3 の列 n   から   テーブル 1 の列 a  
  
 結果的にループが作成されるリレーションシップを作成しようとすると、エラーが生成されます。  
  
##  <a name="detection"></a> リレーションシップの推定  
 テーブル間のリレーションシップは、自動的に連結される場合もあります。 たとえば、次に示す最初の 2 セットのテーブルの間にリレーションシップを作成すると、他の 2 つのテーブルとの間にリレーションシップが存在すると推定され、自動的にリレーションシップが確立されます。  
  
 Products と Category: 手動で作成  
  
 Category と SubCategory: 手動で作成  
  
 Products と SubCategory: リレーションシップの推定  
  
 リレーションシップを自動的に連結するには、上記のように、リレーションシップを一方向にする必要があります。 たとえば最初に、Sales と Products および Sales と Customers の間にリレーションシップが存在している場合は、リレーションシップは推定されません。 これは、Products と Customers の間のリレーションシップが多対多リレーションシップであるためです。  
  
##  <a name="bkmk_detection"></a> データのインポート時のリレーションシップの検出  
 リレーショナル データ ソース テーブルからインポートすると、テーブルのインポート ウィザードによって、それらのソース テーブル内の既存のリレーションシップがソース スキーマ データに基づいて検出されます。 関連するテーブルがインポートされた場合は、それらのリレーションシップがモデルに複製されます。  
  
##  <a name="bkmk_manually_create"></a> リレーションシップの手動作成  
 単一のリレーショナル データ ソース内のテーブル間のほとんどのリレーションシップは自動的に検出され、テーブル モデルで作成されますが、モデル テーブル間のリレーションシップを手動で作成する必要がある場合も数多くあります。  
  
 モデルに複数のソースのデータが含まれる場合は、リレーションシップの手動作成が必要になる可能性が高くなります。 たとえば、Customers、CustomerDiscounts、および Orders テーブルをリレーショナル データソースからインポートできます。 ソースでこれらのテーブル間に存在するリレーションシップは、モデルに自動的に作成されます。 たとえば、別のソースから別のテーブルを追加し、Microsoft Excel のブックに Geography テーブルの地域データをインポートできます。 次に、Customers テーブルの列と Geography テーブルの列との間にリレーションシップを手動で作成できます。  
  
 テーブル モデルでリレーションシップを手動で作成するには、ダイアグラム ビューのモデル デザイナーまたは [リレーションシップの管理] ダイアログ ボックスを使用できます。 ダイアグラム ビューでは、テーブル間のリレーションシップと共にグラフィカルな形式でテーブルが表示されます。 1 つのテーブルの列をクリックし、カーソルを別のテーブルにドラッグして、テーブル間のリレーションシップを正しい順序で簡単に作成できます。 [リレーションシップの管理] ダイアログ ボックスでは、テーブル間のリレーションシップが単純なテーブル形式で表示されます。 リレーションシップを手動で作成する方法については、「 [2 つのテーブル間のリレーションシップの作成 (SSAS テーブル)](create-a-relationship-between-two-tables-ssas-tabular.md)で使用されている方法です。  
  
##  <a name="bkmk_dupl_errors"></a> 値の重複などのエラー  
 リレーションシップで使用できない列を選択すると、その列の横に赤い X が表示されます。 エラー アイコンの上にカーソルを置くと、問題の詳細を示すメッセージが表示されます。 選択した列間のリレーションシップを作成できない原因となる問題には、次のものがあります。  
  
|問題またはメッセージ|解決策|  
|------------------------|----------------|  
|選択した両方の列に重複する値が含まれるため、リレーションシップを作成できない。|有効なリレーションシップを作成するには、選択したペアの少なくとも一方の列には一意の値のみが含まれている必要があります。<br /><br /> 列を編集して重複値を削除するか、一意の値を含む列が **[関連する参照列]** として使用されるように、列の順序を逆にすることができます。|  
|列に NULL 値または空の値が含まれている。|データ列を NULL 値で相互に結合することはできません。 すべての行で、リレーションシップに使用されている両方の列に値が含まれている必要があります。|  
  
##  <a name="bkmk_related_tasks"></a> 関連タスク  
  
|トピック|説明|  
|-----------|-----------------|  
|[2 つのテーブル間のリレーションシップの作成 (SSAS テーブル)](create-a-relationship-between-two-tables-ssas-tabular.md)|2 つのテーブル間のリレーションシップを手動で作成する方法について説明します。|  
|[リレーションシップの削除 (SSAS テーブル)](relationships-ssas-tabular.md)|リレーションシップを削除する方法とリレーションシップの削除がもたらす影響について説明します。|  
  
## <a name="see-also"></a>参照  
 [テーブルと列 (SSAS テーブル)](tables-and-columns-ssas-tabular.md)   
 [データのインポート &#40;SSAS テーブル&#41;](../import-data-ssas-tabular.md)  
  
  
