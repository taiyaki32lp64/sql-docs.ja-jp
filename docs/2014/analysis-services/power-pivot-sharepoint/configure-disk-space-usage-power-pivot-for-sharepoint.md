---
title: 使用 (PowerPivot for SharePoint) のディスク領域の構成 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 201a3fda-f162-45d7-bf39-74dcb92fd0e6
author: minewiskan
ms.author: owend
manager: craigg
ms.openlocfilehash: fc45827a349dc38054db98e3a435f18a42bdaa0f
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/15/2019
ms.locfileid: "66071807"
---
# <a name="configure-disk-space-usage-powerpivot-for-sharepoint"></a>ディスクの使用領域の構成 (PowerPivot for SharePoint)
  PowerPivot for SharePoint の配置では、再読み込みを高速化するために、ホスト コンピューターのディスク領域を使用して、PowerPivot データベースをキャッシュします。 後ですばやく再読み込みして新しい要求を処理できるように、メモリに読み込まれているすべての PowerPivot データベースが最初にディスクにキャッシュされます。 既定では、PowerPivot for SharePoint は、使用できるすべてのディスク領域を使用してデータベースをキャッシュします。ただし、この動作は、使用するディスク領域を制限するプロパティを設定することにより変更できます。  
  
 このトピックでは、ディスク領域の使用量を制限する方法について説明します。  
  
 このトピックには、コンテンツ データベースに格納されている PowerPivot データベース (Excel ブックに埋め込まれている) のディスク領域の管理に関するガイダンスは含まれていません。 PowerPivot データベースのサイズが大きいために、ファームのストレージ容量に対して新たな需要を生じる可能性があります。 また、バージョン管理が有効になっている場合は、同じコンテンツ データベース内のデータの複数のコピーを簡単に作成できるため、コンテンツの格納に必要なディスク領域の量がさらに増える可能性があります。 PowerPivot データベースはディスクの管理において重要な考慮事項ですが、SharePoint ファームに保存されているその他のコンテンツと切り離して管理できるものではありません。 業務での PowerPivot ブックの使用率の増加に応じて、綿密にディスク領域を監視する必要があります。 また、PowerPivot 管理ダッシュボードでは PowerPivot ブックの利用状況を追跡し、使用されなくなったブックを削除することもできます。  
  
## <a name="how-powerpivot-for-sharepoint-manages-cached-databases"></a>キャッシュされているデータベースを PowerPivot for SharePoint で管理する方法  
 キャッシュを管理するために、PowerPivot System サービスでは、未使用のデータベースやコンテンツ ライブラリ内に新しいバージョンがある古いデータベースをクリーンアップするバックグラウンド ジョブを定期的に実行します。 クリーンアップ ジョブの目的は、非アクティブなデータベースをメモリからアンロードすること、および未使用のキャッシュされているデータベースをファイル システムから削除することにあります。 クリーンアップ ジョブは長期的なメンテナンスを目的としており、これによってシステム上にデータベースが無期限に残る状況を回避できます。 アクティブなサーバーの場合、サーバーのメモリ負荷、SharePoint でのデータベースの削除、またはコンテンツ ライブラリ内の新しいバージョンのデータベースが原因で、データベースが削除される頻度が高くなる場合があります。  
  
 クリーンアップ ジョブのスケジュールを設定することはできませんが、次のようにサーバー構成プロパティを設定して、キャッシュ ファイルの管理をカスタマイズできます。  
  
-   キャッシュで使用されるディスク領域のサイズを制限する。  
  
-   最大ディスク容量に達したときに削除するデータの量を指定する。  
  
## <a name="how-to-check-disk-space-usage"></a>ディスク使用量を確認する方法  
 PowerPivot for SharePoint は、SharePoint ファーム内のアプリケーション サーバーにインストールします。 各インストールには、Backup フォルダーを含むデータ ディレクトリがあります。 Backup フォルダーには、コンピューター上の Analysis Services インスタンスによってキャッシュされたすべてのデータ ファイルが含まれています。 既定では、Backup フォルダーは、次のパスにあります。  
  
 `%drive%:\Program Files\Microsoft SQL Server\MSAS10_50.PowerPivot\OLAP\Backup\Sandboxes\<serviceApplicationName>`  
  
 キャッシュで使用される合計ディスク容量を確認するには、Backup フォルダーのサイズを確認する必要があります。 サーバーの全体管理には、現在のキャッシュ サイズをレポートするプロパティがありません。  
  
 Backup フォルダーは、ローカル コンピューターのメモリに読み込まれる任意の PowerPivot データベースの共通のキャッシュ ストレージです。 ファームで複数の PowerPivot サービス アプリケーションを定義した場合は、それぞれがローカル サーバーを使用して PowerPivot データを読み込み、キャッシュすることができます。 データの読み込みとキャッシュは、どちらも Analysis Services サーバーの操作です。 したがって、ディスクの合計使用量は、Backup フォルダーにおいて Analysis Services インスタンス レベルで管理されます。 このため、ディスク使用量を制限する構成設定は、SharePoint アプリケーション サーバー上で実行される単一の SQL Server Analysis Services インスタンスで設定します。  
  
 キャッシュには、PowerPivot データベースのみが格納されます。 PowerPivot データベースは、1 つの親フォルダー (Backup フォルダー) の下に複数のファイルとして格納されます。 PowerPivot データベースは Excel ブックの内部データとして使用することが意図されているため、データベース名はわかりやすい名前ではなく、GUID ベースになっています。 下にある GUID フォルダー  **\<serviceApplicationName >** PowerPivot データベースの親フォルダーです。 PowerPivot データベースがサーバーに読み込まれると、データベースごとに追加のフォルダーが作成されます。  
  
 PowerPivot データはファーム内の Analysis Services インスタンスに読み込まれることがあるため、同じデータがファーム内の複数のコンピューターにキャッシュされる可能性があります。 この処理ではディスク領域の使用率よりパフォーマンスを優先していますが、その代わりに、既にディスク上で使用可能になっているデータにユーザーが迅速にアクセスできます。  
  
 ディスク領域の消費量をすぐに減らすには、サービスを停止し、Backup フォルダーから PowerPivot データベースを削除します。 ファイルを手動で削除するのは、一時的な措置です。次回 PowerPivot データに対してクエリを実行すると、データベースの新しいコピーが再度キャッシュされるためです。 永続的な解決方法としては、キャッシュで使用されるディスク領域を制限する方法があります。  
  
 システム レベルでは、ディスク領域が少なくなったときに通知する電子メールによる警告を作成できます。 Microsoft System Center には、電子メール警告機能があります。 また、ファイル サーバー リソース マネージャー、タスク スケジューラ、または PowerShell スクリプトを使用して、警告を設定することもできます。 次のリンクでは、ディスク領域不足に関する通知を設定するための有用な情報が提供されています。  
  
-   [新しいファイル サーバー リソース マネージャーでは](https://technet.microsoft.com/library/hh831746.aspx)(https://technet.microsoft.com/library/hh831746.aspx) します。  
  
-   [Windows Server 2008 R2 のファイル サーバー リソース マネージャーのステップ バイ ステップ ガイド](https://go.microsoft.com/fwlink/?LinkID=204875)(https://go.microsoft.com/fwlink/?LinkID=204875) します。  
  
-   [Windows Server 2008 でディスクの空き領域のアラートの設定](https://go.microsoft.com/fwlink/?LinkID=204870)(https://go.microsoft.com/fwlink/?LinkID=204870) します。  
  
## <a name="how-to-limit-the-amount-of-disk-space-used-for-storing-cached-files"></a>キャッシュされたファイルの格納に使用するディスク領域のサイズを制限する方法  
  
1.  サーバーの全体管理で、[アプリケーション構成の管理] の **[サーバーのサービスの管理]** をクリックします。  
  
2.  **[SQL Server Analysis Services]** をクリックします。  
  
     制限は、サービス アプリケーション レベルではなく、物理サーバー上で実行される Analysis Services インスタンスに対して設定されます。 ローカルの Analysis Services インスタンスを使用するすべてのサービス アプリケーションが、そのインスタンスに設定されている 1 つの最大ディスク領域の制限の対象となります。  
  
3.  [ディスク使用量] の **[合計ディスク領域]** で、キャッシュ用に使用されるディスク容量の上限を制限する値を GB 単位で設定します。 既定値は 0 です。この場合、Analysis Services は使用可能なすべてのディスク領域を使用できます。  
  
4.  ディスク使用量 で、**キャッシュされた最後の 'n' 内のデータベースの削除時間**キャッシュを空にすると、ディスク領域が上限に最近使用した条件を指定を設定します。  
  
     既定値は 4 時間です。この場合、4 時間以上非アクティブであったすべてのデータベースがファイル システムから削除されます。 非アクティブであってもまだメモリ内にあるデータベースは、アンロードされた後、ファイル システムから削除されます。  
  
## <a name="how-to-limit-how-long-a-database-is-kept-in-the-cache"></a>データベースがキャッシュ内に保持される期間を制限する方法  
  
1.  サーバーの全体管理で、[アプリケーション構成の管理] の **[サービス アプリケーションの管理]** をクリックします。  
  
2.  クリックして**Default PowerPivot Service Application**管理ダッシュ ボードを開きます。  
  
3.  [アクション] で **[サービス アプリケーションの設定の構成]** をクリックします。  
  
4.  [ディスク キャッシュ] セクションで、新しい要求を処理するために非アクティブなデータベースをメモリ内に保持する期間 (既定では 48 時間) およびキャッシュ内に保持する期間 (既定では 120 時間) を指定できます。  
  
     **[非アクティブなデータベースをメモリ内に保持]** では、非アクティブなデータベースのデータに対する新しい要求を処理するために、そのデータベースをメモリ内に保持する期間を指定します。 アクティブなデータベースは、そのデータベースに対してクエリを実行している限り、メモリ内に常に保持されます。アクティブでなくなると、そのデータに対する要求が発生する場合に備えて、データベースはメモリ内に一定期間保持されます。  
  
     PowerPivot データベースは最初にキャッシュされてからメモリに読み込まれるため、データベース ファイルによってディスク領域がすぐに消費されます。 ただし、データベースがアクティブな間 (およびその後 48 時間)、すべての要求は最初にメモリ内のデータベースに送られ、キャッシュされたデータベースは無視されます。 ファイルは、非アクティブな状態で 48 時間を経過するとメモリからアンロードされますが、ローカルの PowerPivot サーバー インスタンスがそのデータに対する新しい接続要求を受けた場合にすばやくロードできるようにキャッシュ内に保持されます。 非アクティブなデータベースへの接続要求は、コンテンツ ライブラリではなく、キャッシュから処理されます。そのため、コンテンツ データベースへの影響は最小限に抑えられます。  
  
     コンテンツ ライブラリは PowerPivot データベースの唯一の永続的な場所であることに注意してください。 キャッシュされたコピーは、ライブラリ内のデータベースがディスク上のコピーと同じ場合にのみ使用されます。  
  
     **[非アクティブなデータベースをキャッシュ内に保持]** では、非アクティブなデータベースがメモリからアンロードされた後にファイル システム上に保持される期間を指定します。 クリーンアップ ジョブでは、この設定を使用して、削除するファイルを特定します。 168 時間 (メモリ内に 48 時間とキャッシュ内に 120 時間) 非アクティブなすべての PowerPivot データベースは、クリーンアップ ジョブによってディスクから削除されます。  
  
5.  **[OK]** をクリックして変更を保存します。  
  
## <a name="next-steps"></a>次の手順  
 サーバーの状態、構成、または可用性の問題が検出された場合に修正措置を実行できるように、PowerPivot for SharePoint のインストールには正常性ルールが用意されています。 一部のルールでは、構成設定を使用して、正常性ルールがトリガーされる条件が決定されます。 サーバー パフォーマンスを積極的にチューニングしている場合は、これらの設定を確認して、既定値がシステムに最適であることを確認するようにします。 詳細については、次を参照してください。 [PowerPivot の正常性ルール - 構成](configure-power-pivot-health-rules.md)します。  
  
## <a name="see-also"></a>参照  
 [サーバーの全体管理での PowerPivot サーバーの管理と構成](power-pivot-server-administration-and-configuration-in-central-administration.md)  
  
  
